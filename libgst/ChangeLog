2005-02-02  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/alloc.c (NO_MALLOC_OVERRIDE): New define.
	(malloc, realloc, free, calloc): Define only if NO_MALLOC_OVERRIDE
	is not defined.
	(morecore): Do not use the system heap (sbrk) if NO_MALLOC_OVERRIDE
	is defined.

2004-12-20  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.h (O_NONBLOCK): Unused, remove.

2004-11-25  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/oop.c: Catch more errors out of mprotect.

2004-11-25  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/alloc.h: Use char for the type of large.data
	in struct heap_block.

2004-11-03  Paolo Bonzini  <bonzini@gnu.org>

	* lib-src/poll_.h: New name of...
	* lib-src/poll.h: ... this removed file.

2004-09-05  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/lib.c: Backport parameter passing fixes from 2.2.

2004-08-23  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/cint.c: Pass parameters as longs.

2004-08-21  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/gstpriv.h: Enforce long double alignment for obstacks.
	* libgst/alloc.c: Support 16k pages and long double alignment of
	malloc-ed blocks.
	* libgst/alloc.h: Likewise.

2004-03-25  Paolo Bonzini  <bonzini@gnu.org>

	* lib-src/obstack.h: Get current version.
	* libgst/prims.def: Fix C99-ism.

2004-01-30  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/comp.c: fix bug in compilation of ##() expression
	where the expression evaluates to an integer.

2004-01-15  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/dict.c: Return nil if searching a pool variable
	in a non-Dictionary class.

2004-01-08  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/dict.c: do not scavenge before the interpreter
	is activated.
	* libgst/interp.c: check for IS_NIL (_gst_this_context_oop),
	not for ip != NULL, to see if a process is active.
	* libgst/interp-jit.inl: refresh native IP of processes if the
	method they are executing is not translated anymore.

2003-12-13  Paolo Bonzini  <bonzini@gnu.org>

        * libltdl: die die die
        * lib-src/ltdl.c: moved from libltdl.
        * lib-src/ltdl.h: moved from libltdl.

2003-11-04  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/prims.def: use nanosleep instead of usleep.

2003-09-18  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp-bc.inl: only set last_primitive for succeeded
	primitives.

2003-09-07  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/dict.c: create CSymbols as an instance of Namespace.

2003-09-02  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/comp.c: don't rely on _gst_is_kernel_file
	* libgst/input.c: death to _gst_store_no_source and _gst_is_kernel_file
	* libgst/input.h: death to _gst_store_no_source and _gst_is_kernel_file
	* libgst/lib.c: death to _gst_store_no_source

        * libgst/interp.c: don't let the current process die on image
        reload.

2003-07-21  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/cint.c: allow to pass integers as float or doubles
	(but not vice versa).

2003-07-10  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/comp.c: recalculate number of temporaries used
	by a block after it is compiled.

2003-07-09  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/oop.c: don't scavenge before allocating big
	objects.
	* libgst/prims.def: use _gst_init_mem to set GC
	parameters.

2003-07-08  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp.c: initialize Processor's gcSemaphore
	* libgst/interp.h: define gcSemaphore and gcArray
	* libgst/dict.c: likewise
	* libgst/oop.c: use it to mourn objects
	* libgst/sym.h: no mourn symbol anymore
	* libgst/sym.c: no mourn symbol anymore

        * libgst/dict.c: use IS_OOP_VALID_GC during image load
        * libgst/oop.c: use IS_OOP_VALID_GC during the GC
        * libgst/oop.inl: complicate validity test to take
        into account incremental GC-ing of old objects.
        * libgst/save.c: use IS_OOP_VALID_GC since we finish
        the incremental GC before saving.

2003-06-28  Paolo Bonzini  <bonzini@gnu.org>

	*** Version 2.1.3 released.

2003-06-23  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/comp.c: death to _gst_get_method_descriptor and
	_gst_set_method_descriptor.

2003-06-15  Paolo Bonzini  <bonzini@gnu.org>

        * libgst/xlat.c: new function _gst_reset_inline_caches;
	prefix _gst_ to global functions
        * libgst/xlat.h: ditto
        * libgst/interp.c: invoke _gst_reset_inline_caches
	* libgst/comp.c: callers adjusted.
	* libgst/oop.c: callers adjusted.
	* libgst/oop.inl: callers adjusted.
	* libgst/prims.def: callers adjusted.

2003-06-11  Paolo Bonzini  <bonzini@gnu.org>

        * libgst/gstpriv.h: check for SmallIntegers in
        read-only accessors.
        * libgst/prims.def: don't crash in read-only and
	weak object-related primitives

2003-06-10  Paolo Bonzini  <bonzini@gnu.org>

        * libgst/oop.c: death to _gst_fixup_metaclass_objects.
        * libgst/oop.h: ditto.

2003-06-09  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp-bc.inl: REGISTER with structs is not good.
	* libgst/interp-jit.inl: REGISTER with structs is not good.

2003-06-08  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp.c: don't trap SIGBUS.

2003-06-05  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/oop.c: check for out of range _gst_mem.scan.queue_at
	while scanning, not in QUEUE_NEXT.

2003-06-04  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/genpr-parse.y: start primitive numbers
	from 1.

2003-05-27  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/prims.def: add VMpr_Object_allOwners
	* libgst/dict.inl: implement is_owner

2003-05-09  Paolo Bonzini  <bonzini@gnu.org>

	*** Version 2.1.2 released.

	* libgst/alloc.c: rationalize inclusions
	* libgst/byte.c: rationalize inclusions
	* libgst/callin.c: rationalize inclusions
	* libgst/cint.c: rationalize inclusions
	* libgst/comp.c: rationalize inclusions
	* libgst/dict.c: rationalize inclusions
	* libgst/dict.inl: rationalize inclusions
	* libgst/events.c: rationalize inclusions
	* libgst/gstpriv.h: add more inclusions
	* libgst/heap.c: rationalize inclusions
	* libgst/input.c: rationalize inclusions
	* libgst/interp-bc.inl: rationalize inclusions
	* libgst/interp.c: rationalize inclusions
	* libgst/interp.inl: rationalize inclusions
	* libgst/lex.c: rationalize inclusions
	* libgst/lib.c: rationalize inclusions
	* libgst/mpz.c: rationalize inclusions
	* libgst/oop.c: rationalize inclusions
	* libgst/opt.c: rationalize inclusions
	* libgst/print.c: rationalize inclusions
	* libgst/save.c: rationalize inclusions
	* libgst/str.c: rationalize inclusions
	* libgst/sym.c: rationalize inclusions
	* libgst/sysdep.c: rationalize inclusions
	* libgst/tree.c: rationalize inclusions
	* libgst/xlat.c: rationalize inclusions
	* libgst/comp.h: rationalize inclusions
	* libgst/opt.h: rationalize inclusions
	* libgst/interp.h: rationalize inclusions

2003-05-06  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp.c: define PROTECT_CURRENT_PROCESS_WITH
	and PROTECT_FROM_INTERRUPT_WITH.  Use them in
	parse_stream_with_protection
	* libgst/prims.def: use them.

	* libgst/cint.h: declare _gst_errno and _gst_set_errno
	* libgst/cint.c: saved_errno -> _gst_errno, implement
	_gst_set_errno
	* libgst/prims.def: the VMpr_ObjectMemory_snapshot
	primitive can fail; use _gst_set_errno

	* libgst/save.c: invoke hook after opening the file.

2003-04-28  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/input.c: don't advance the pointer in a
	STREAM_STRING after EOF; don't unread an EOF as
	_gst_next_char will return an EOF again.
	* libgst/lex.c: change the lexing functions to
	accept an int so that EOF and 255 are not confused.

2003-04-27  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.c: return ENOMEM properly under Win32.
	Separate detection of availability of a particular technique
	and reservation of memory.  find_heap_base renamed to
	anon_mmap_check.

2003-04-17  Paolo Bonzini  <bonzini@gnu.org>

        *** Version 2.1.1 (stable) released.

	* libgst/sysdep.c: allow MAP_NORESERVE even if MAP_ANON
	is not available.  Encapsulate opening /dev/zero into
	a macro which is used the same way when MAP_ANON is used
	and when it is not.

2003-04-16  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/genpr-parse.y: add ATTRIBUTE_UNUSED attributes to
	the primitives' arguments.
	* libgst/input.c: use newer function rl_completion_matches
	instead of completion_matches.
	* libgst/alloc.c: fix for Cygwin, always #undef small
	* libgst/sysdep.c: fix for Cygwin, include process.h
	and don't do setsid if HAVE_SPAWNL
	* libgst/lib.c: don't load .stinit in regression
	testing mode, disable regression testing mode when
	loading .stpre.

2003-04-12  Paolo Bonzini  <bonzini@gnu.org>

	*** Version 2.1 (stable) released.

2003-04-09  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp-bc.inl: endExecution must FLUSH,
	not END (this broke the IA64).

2003-04-08  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/interp.inl: add definitions to support
	broken inttypes.h like FreeBSD's.
	* libgst/sysdep.c: move the declaration of the FD
	static variable before _gst_osmem_alloc.

2003-04-07  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/dict.c: fix mismatch between sizeof argument
	and actual type.

2003-03-30  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/lex.c: strdup -> xstrdup
	* libgst/alloc.c: define xstrdup
	* libgst/alloc.h: define xstrdup
	* libgst/input.c: strdup -> xstrdup
	* libgst/lex.c: strdup -> xstrdup
	* libgst/lib.c: strdup -> xstrdup
	* libgst/sysdep.c: strdup -> xstrdup

2003-03-26  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/byte.c: remove checks on availability of bytecode array.
	Make explicit calls to allocate bytecode array.
	* libgst/comp.c: make explicit calls to allocate bytecode array.
	* libgst/opt.c: likewise.

	* libgst/comp.c: associate stack depth to each bytecode array.
	Fix bugs along the way.
	* libgst/byte.c: Add support for saving and restoring stack
	depth.
	* libgst/byte.h: fix declarations.  Move stack depth modification
	macros here from comp.c.

	* libgst/comp.c: count depth from 0, not from argCount+tempCount,
	and sum the number of arguments only at the end (because
	the tempCount might change if there are #to:do: loops!)
	* libgst/save.c: check for file version <= VERSION_REQUIRED,
	not ==.

2003-03-23  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/prims.def: extract a loop invariant from
	VMpr_Behavior_someInstance

2003-03-21  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.c: added _gst_full_write
	* libgst/input.c: use it instead of _gst_write
	* libgst/save.c: use it instead of _gst_write

2003-03-19  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.c: always provide _gst_recv & _gst_send
	* libgst/sysdep.h: always declare them
	* libgst/save.c: include socketx.h

2003-03-15  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/dict.inl: fix initialization of word
	subclasses.

2003-03-14  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.c: make _gst_read and _gst_write
	abort on EFAULT
	* libgst/prims.def: use them
	* libgst/input.c: use them

2003-03-04  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/lib.c: load exception handling before VFS.
	* libgst/sysdep.c: redisorganize _gst_open_pipe into
	separate functions.  Use spawnl and Win32 pipes if
	available.

2003-03-02  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/oop.c: don't reset the heap_limit if the
	heap was grown.

2003-03-01  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/heap.c: move system dependent stuff
	* libgst/sysdep.c: ...here
	* libgst/sysdep.h: make it public

	* lib-src/socketx.h: new file
	* lib-src/poll.c: include it

	* libgst/prims.def: move enum with file operations...
	* libgst/interp.h: ...here

	* libgst/prims.def: define primitive for sockets
	* libgst/sysdep.c: define _gst_full_send
	* libgst/sysdep.h: declare _gst_full_send

	* libgst/heap.c: define routines for mmap/munmap
	* libgst/heap.h: declare them
	* libgst/alloc.c: use them

2003-02-28  Paolo Bonzini  <bonzini@gnu.org>

	* lib-src/signalx.h: new file
	* lib-src/signalx.c: new file
	* libgst/events.c: include signalx.h
	* libgst/heap.c: include signalx.h
	* libgst/interp.c: include signalx.h
	* libgst/sysdep.c: include signalx.h

2003-02-28  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/sysdep.c: cook up a simple mechanism to disable
	and enable signals where the OS does not provide that (again,
	MinGW32).  Fix semicolons in DISABLE and ENABLE.  Don't block
	fatal errors.

2003-02-27  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/cint.c: turn malloc to xmalloc
	* libgst/save.c: turn malloc to xmalloc
	* libgst/sym.c: turn free to xfree

	* libgst/alloc.c: disable usage as system malloc under MinGW32.
	* libgst/sysdep.c: include process.h if we have it (MinGW32)
	* libgst/events.c: likewise
	* libgst/sysdep.c: implement _gst_mem_protect
	* libgst/sysdep.h: declare it and PROT_*
	* libgst/oop.c: use it

2003-02-25  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/oop.c: avoid out-of-memory while compacting
	* libgst/print.c: tweak the precision for FloatE's,
	FloatD's and FloatQ's depending on float.h, except
	in regression testing mode.

2003-02-15  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/heap.c: support !HAVE_SBRK
	* libgst/prims.def: support !HAVE_USLEEP
	* libgst/sysdep.c: use _beginthread under MinGW32 instead of
	CreateThread
	* libgst/interp.c: use raise instead of kill
	* libgst/sysdep.c: ditto
	* libgst/events.c: ditto

2003-02-13  Paolo Bonzini  <bonzini@gnu.org>

	* libgst/gst.h: tweak a little the definition of alloca
	* libgst/heap.c: fix typos, add WIN32_LEAN_AND_MEAN
	* libgst/oop.c: add cast to fix gcc 2.95 warning
	* libgst/prims.def: use POP_N_OOPS to fix gcc 2.95 warning
	* libgst/save.c: disable mmap-ing under WIN32
	* libgst/sysdep.c: add WIN32_LEAN_AND_MEAN

2003-03-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: don't print C backtrace during
	compilation if SIGINT is received.

2003-02-07  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/heap.c: fix brokenness of Win32 implementation.
	* libgst/alloc.c: add a very basic logging mechanism.
	* libgst/interp.c: add a very basic backtracing mechanism
	to the signal handlers.  Trap SIGILL when JIT-compiling.
	Fix mismatch between process operation of JIT compiler
	and bytecode interpreter.
	* libgst/print.c: print FloatD and FloatQ objects with
	the correct letter for the exponent

2003-02-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/alloc.c: abort on an evident double free (two
	frees of the same object without any free on the same
	page in the middle).
	* libgst/oop.c: add notice about bad interaction between
	SIGSEGV trapping and valgrind.
	* libgst/events.c: use pointer to tail's next pointer
	instead of pointer to tail.  Suggested by Carlos Moran.

2003-02-03  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/alloc.c: allow one to free the NULL pointer
	liberally.
	* libgst/opt.c: drop broken code.
	* libgst/opt.h: adjust prototypes
	* libgst/xlat.c: adjust users

2003-01-20  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: keep the returned value of a doit in
	the incubator until after the #afterEvaluation hook is
	completed.

2003-01-17  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-jit.inl: check for code not having been
	compiled yet moved before check for native_ip == 0

2003-01-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: while loading standard files disable
	_gst_regression_testing.

	* libgst/input.c: define _gst_warningf and _gst_warningf_at
	* libgst/input.h: declare them
	* libgst/gst-parse.y: use them; don't trigger a warning
	when *defining* a method named #true, #false and the like

	* libgst/save.c: never read past the end of the file

2003-01-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.c: make child process a session group
	leader

2003-01-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: fix bug in _gst_execute_statements

	* libgst/sym.c: define _gst_pop_all_scopes
	* libgst/sym.h: declare it
	* libgst/comp.c: use it

2003-01-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst-parse.y: get rid of right recursion and
	shift/reduce conflicts.
	* libgst/tree.c: TREE_STATEMENT_LIST now a list node
	* libgst/tree.h: adjust documentation
	* libgst/comp.c: adjust functions that compile
	statement lists.

	* libgst/lib.c: bump copyright year
	* libgst/interp-jit.inl: cleanup #if 0 sections
	* libgst/prims.def: valueAndResumeOnUnwind loses the
	cache_new_ip attribute.

2002-12-31  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/prims.def: always use PUSH_OOP to push the
        result in VMpr_CObject_at.  Thanks to David Forster.

2002-12-29  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/cint.c: strdup the name of the function in
        _gst_define_cunc (it is freed when the call happens
        from Smalltalk).  Thanks to David Forster.

2002-12-27  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0g released

	* libgst/prims.def: fix ISO C99-ism
	* libgst/input.c: fix compilation error when readline
	is not there

2002-12-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.c: don't print negative percentages
	* libgst/prims.def: add ObjectMemory>>#abort primitive
	* libgst/interp-bc.inl: fix single step mode
	* libgst/interp-jit.inl: fix single step mode

2002-12-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: incubate everything sent through
	_gst_msg_sendf.

2002-12-12  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.10 released

	* libgst/input.c: register the file name object in
	_gst_get_cur_file_name, unregister it in my_close
	* libgst/oop.c: add more assertions
	* libgst/save.c: add more assertions

2002-12-11  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst-parse.y: new name of gst.y
	* libgst/tree.h: adjust

	* libgst/genpr-scan.l: new file
	* libgst/genpr-parse.y: new file
	* libgst/genprims.h: new file
	* libgst/prims.def: merge with prims.inl again, but with
	genprims' syntax
	* libgst/interp.c: remove cruft for multiple inclusions
	of prims.def, we only include the generated prims.inl

2002-12-05  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.9 (stable) and 2.0f (development) released

	* libgst/interp.c: add _gst_check_process_state
	* libgst/interp.h: add _gst_check_process_state

	* libgst/interp.c: do suspend_process correctly when
	the process is in the middle of the process list.

2002-12-04  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/alloc.c: abort instead of asserting
	* libgst/save.c: likewise

	* libgst/dict.c: abort instead of calling _gst_debug
	* libgst/dict.inl: likewise
	* libgst/gstpriv.h: likewise
	* libgst/oop.c: likewise
	* libgst/sym.c: likewise
	* libgst/interp.c: likewise
	* libgst/xlat.c: likewise

	* libgst/prims.inl: abort on a bootstrapping error
	* libgst/interp.c: catch SIGABRT instead of SIGSEGV

2002-12-01  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/heap.c: provide a fallback whenever
	MAP_NORESERVE is used.

2002-11-29  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.y: fix a couple of shift/reduce conflicts

	* libgst/gstpriv.h: min->MIN, max->MAX, abs->ABS
	* libgst/mpz.c: adjusted
	* libgst/opt.c: adjusted
	* libgst/oop.c: adjusted
	* libgst/save.c: adjusted

	* libgst/oop.c: remove warning
	* libgst/prims.inl: implement asynchronous call-out.
	* libgst/prims.def: implement asynchronous call-out.

2002-11-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/md5.c: remove warnings in -Wtraditional mode.

2002-11-19  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0e released

	* libgst/oop.c: add _gst_grey_oop_range
	* libgst/oop.h: declare it
	* libgst/prims.inl: check for EFAULT and abort if so.

2002-11-16  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/sysdep.c: always do the F_SETOWN fcntl after F_SETFL
	for the benefit of FreeBSD (thanks to Danilo Fiorenzano).
	And always do the F_SETFL fcntl before FIOASYNC for the
	benefit of Cygwin.

2002-11-15  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.8 (stable) released

	* libgst/comp.c: optionally make the method return the last value
	in _gst_compile_method, use that in _gst_execute_statements,
	don't free the trees in _gst_compile_method
	* libgst/gst.y: adjust callers of _gst_compile_method and
	_gst_execute_statements, support ##(...) for compile-time-constants,
	free the trees here
	* libgst/tree.c: remove parameter from _gst_free_tree
	* libgst/tree.h: adjust _gst_free_tree

	* libgst/dict.c: get rid of CFunctionDescs

2002-11-14  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: new C callout primitive, removed
	methodOOP parameter from primitives
	* libgst/interp.c: adjusted
	* libgst/interp.h: adjusted
	* libgst/interp-bc.inl: adjusted
	* libgst/interp-jit.inl: adjusted
	* libgst/cint.c: adjusted
	* libgst/cint.h: adjusted

	* libgst/lib.c: load additional core classes *before* the C interface
	since it now uses ValueHolder.

2002-11-13  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.inl: define identity_dictionary_find_key
	* libgst/dict.c: use it

	* libgst/prims.inl: moved parts to interp.c and prims.def
	* libgst/prims.def: created from prims.inl
	* libgst/interp.c: added parts of prims.inl

2002-11-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: add VMpr_Semaphore_lock

2002-11-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: start a new process in
	_gst_prepare_execution_environment,
	implement _gst_nvmsg_send here, added suspend_process
	and terminate_process, refine detection of "No runnable
	process" condition
	* libgst/prims.inl: handle the call-in chain
	* libgst/interp-bc.inl: new argument and return value for _gst_interpret
	* libgst/interp-jit.inl: new argument and return value for _gst_interpret
	* libgst/interp.h: added _gst_nvmsg_send
	* libgst/comp.c: use _gst_nvmsg_send to call #executeStatements
	* libgst/callin.c: base everything on _gst_nvmsg_send
	* libgst/dict.c: add DirectedMessage-related stuff and
	_gst_callin_process_class
	* libgst/dict.h: likewise
	* libgst/lib.c: load DirMessage.st early, and CallinProcess.st

	* libgst/alloc.c: don't move reallocated objects that
	get smaller (code produced by the JIT is not position
	independent!)
	* libgst/xlat.c: fix some bit-rot
	* libgst/opt.c: fix off-by-one error in _gst_compute_stack_positions

2002-11-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/poll.c, lib-src/poll.h: support XPG4 just in case

	* libgst/heap.c: use MAP_NORESERVE if available.
	* libgst/alloc.c: resort to mmap-ed areas once we cannot
	use sbrk anymore.

2002-11-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.c: unprotect freed pages, fix bug in removing
	pages from remembered table upon freeing.  Blox up and running
	with generational and incremental GC.
	* libgst/save.c: use buffered I/O.

2002-11-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.c: strdup in _gst_push_string_stream
	* libgst/callin.c: so we have to close the streams
	* libgst/comp.c: here as well

	* libgst/alloc.c: ensure a block has already been touched
	(written to) before doing free-list operations.  Otherwise,
	the SIGSEGV handler might allocate memory while the free-lists
	are not consistent.
	* libgst/oop.c: for #become:, ensure the two swapped objects are
	in the same generation.  Otherwise, references to the new-space
	object that used to point to the old-space object are not recorded
	in the remembered set.

2002-11-04  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0e (development) released

2002-10-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/alloc.c: more hooks
	* libgst/oop.c: use them

2002-10-25  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/interp-bc.inl: fix an obscure re-entrancy bug
        in _gst_send_message_internal, which was commonly
	triggered by the new garbage collector in the ANSI test
	suite.

2002-10-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.c: put back support for growing the OOP table.

2002-10-22  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sym.c: add more consts
	* libgst/sym.h: likewise
	* libgst/cint.c: likewise
	* libgst/cint.h: likewise
	* libgst/callin.c: likewise
	* libgst/callin.h: likewise
	* libgst/gstpub.h: likewise

2002-10-22  Mike Castle  (dalgoda@ix.netcom.com)

        * libgst/callin.c: fixes for Tcl 8.4.0 (add some consts)
        * libgst/callin.h: fixes for Tcl 8.4.0 (add some consts)
        * libgst/dict.c: fixes for Tcl 8.4.0 (add some consts)
        * libgst/dict.h: fixes for Tcl 8.4.0 (add some consts)
        * libgst/gstpub.h: fixes for Tcl 8.4.0 (add some consts)

2002-10-21  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/alloc.c: collect statistics
	* libgst/dict.c: add instance variables to ObjectMemory
	* libgst/oop.c: collect statistics
	* libgst/oop.h: declare functions to export statistics
	* libgst/prims.inl: adjust for statistic collection

2002-10-17  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.7 (stable) released

	* libgst/alloc.c: add some hooking abilities

	* libgst/oop.c: big rewrite for switch to generational GC
	* libgst/oop.h: likewise
	* libgst/oop.inl: likewise
	* libgst/save.c: likewise
	* libgst/print.c: likewise (debugging functions)

	* libgst/gstpriv.h: moved parts to oop.inl or oop.h, changed
	many flags for the new generational collector.

	* libgst/dict.c: adjust for changes in variable names
	* libgst/prims.inl: adjust for changes in variable names

       * libgst/gstpriv.h: define checks for !OPTIMIZE.
       * libgst/input.c: define readline_getc only if readline
       is used.
       * libgst/interp-bc.inl: fix syntax error for !OPTIMIZE.
       * libgst/lib.c: load FileDescr.st before ObjectMemory.

2002-10-15  Paolo Bonzini  (bonzini@gnu.org)

       * libgst/lib.c: print "GNU Smalltalk ready" only before
       reading from stdin.  `verbose' --> _gst_verbose.
       * libgst/lib.h: declare _gst_verbose.
       * libgst/comp.c: conditionalize printing of stats and
       explanations on _gst_verbose and _gst_regression_testing.
       * libgst/comp.h: remove `quiet' parameter to
       _gst_execute_statements.
       * libgst/gst.y: caller adjusted

2002-10-13  Paolo Bonzini  (bonzini@gnu.org)

       * libgst/interp.c: include strspell.h
       * lib-src/strspell.c: new file
       * lib-src/strspell.h: new file
       * libgst/prims.inl: define VMpr_String_similarityTo

2002-10-08  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/print.c: don't segfault when printing a Metaclass
	that has no class yet.

2002-10-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.c: add the period to the word-termination
	characters.

	* libgst/dict.c: declare AbstractNamespace and
	BindingDictionary; support arbitrary number of instance
	variables in dictionaries
	* libgst/dict.h: likewise
	* libgst/dict.inl: likewise
	* libgst/lib.c: load AbstNamespace.st and BindingDict.st

	* libgst/byte.h: add LINE_NUMBER_BYTECODE; declared
	_gst_line_number
	* libgst/byte.c: print it; added _gst_line_number
	* libgst/comp.c: use _gst_line_number
	* libgst/gst.y: track locations
	* libgst/lex.c: track locations
	* libgst/input.h: added _gst_get_location
	* libgst/input.c: implemented it
	* libgst/tree.h: added location field to trees
	* libgst/tree.c: store locations in trees
	* libgst/interp-bc.c: treat LINE_NUMBER_BYTECODE as nop
	* libgst/xlat.c: treat LINE_NUMBER_BYTECODE as nop

2002-10-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: set F_XLAT_REACHABLE in the method
	and block prolog.
	* libgst/oop.c: GC unused JITted code.

2002-10-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/heap.c: use EFAULT as an addition to SIGSEGV instead
	of an alternative method to detect unmapped memory areas
	* libgst/interp-bc.inl: don't use [ a ... b ] initializers
	because Apple's gcc is actually an Objective C compiler.

2002-09-29  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/alloc.c: removed
	* lib-src/alloc.h: removed
	* libgst/alloc.c: new file
	* libgst/alloc.h: new file

2002-09-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: added HomedAssociation and associated
	declarations
	* libgst/dict.h: added _gst_homed_association_class
	* libgst/lib.c: load it

	* libgst/gstpriv.h: remove finalization and add ephemerons
	* libgst/oop.c: likewise
	* libgst/prims.inl: likewise
	* libgst/sym.c: remove #finalize symbol and add #mourn
	* libgst/sym.h: likewise

	* libgst/lib.c: set line-based buffering for stdout in
	regression testing mode.

2002-09-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.inl: simplify inst_var_at and inst_var_at_put
	* libgst/prims.inl: inst_var_at_put now void, adjust caller.

2002-09-25  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.y: better error recovery

2002-09-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.inl: do memcpy to char * instead of to
	double * (because that does not solve double unalignment
	problems).
	* libgst/input.c: my_getc reads unsigned chars.

2002-09-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: added interruptLock variable to Process
	* libgst/interp.h: added interruptLock field to gst_process
	* libgst/interp.c: semaphore_new() accepts a parameter
	for the initial number of signals.  Create the interruptLock
	when a new Process is created.

2002-09-18  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: the highest priority process was being
	put in the process list for priority 4 even if it did
	not belong there.

2002-09-13  Paolo Bonzini  (bonzini@gnu.org)

        *** Versions 2.0c (development) and 2.0.6 (stable) released

	* libgst/prims.inl: allow specifying a class as the
	current namespace

2002-09-11  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lex.c: support :: as well as . to separate
	namespaces
	* libgst/gst.y: do corresponding changes in the grammar
	as well as changes to support compile-time namespace
	resolution
	* libgst/dict.c: allow specifying a class as a pool
	dictionary and create namespaces at bootstrap
	* libgst/sym.c: extend VARIABLE_NODE treatment in
	_gst_find_variable to support compile-time namespace
        resolution
	* libgst/sym.h: _gst_find_variable accepts a tree_node
	* libgst/comp.c: callers adjusted
	* libgst/tree.h: split tree node type TREE_VARIABLE_LIST
	into TREE_VAR_DECL_LIST and TREE_VAR_ASSIGN_LIST
	* libgst/tree.c: likewise

	* libgst/dict.c: give interrupt state to Processes
	* libgst/interp.h: likewise
	* libgst/interp.c: use it
	* libgst/prims.inl: implement interrupt-handling
	primitives

	* libgst/lib.c: load RecursionLock.st, drop short names
	* libgst/dict.c: give a name to Semaphores
	* libgst/interp.h: likewise

	* libgst/sysdep.h: _gst_disable_interrupts and
	_gst_enable_interrupts hold their state internally
	* libgst/sysdep.c: implement this
	* libgst/events.c: callers adjusted
	* libgst/interp-bc.inl: callers adjusted
	* libgst/interp-jit.inl: callers adjusted
	* libgst/prims.inl: callers adjusted
	* libgst/interp.c: callers adjusted

2002-09-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: compute stack depth correctly in the
	presence of cascades.
	* libgst/oop.c: add valgrind hooks after OOPs are swept,
	fix _gst_alloc_words (was not always converting size
	from words to bytes)

2002-09-09  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/dict.c: pass flags to alloc_oop
        * libgst/interp.c: pass flags to alloc_oop
        * libgst/oop.c: pass flags to alloc_oop, check
        for opportunities to grow the OOP table in sweep_oop
        * libgst/oop.inl: receive flags in alloc_oop, force a
        GC as soon as possible (instead of triggering it)
        in low-water conditions

	* libgst/print.c: print subclasses of Association as
	Associations.
	* libgst/dict.h: declared _gst_variable_binding_class
	* libgst/dict.c: declared _gst_variable_binding_class,
	use NAMESPACE_AT_PUT
	* libgst/dict.inl: new function variable_binding_new
	and macro NAMESPACE_AT_PUT
	* libgst/sym.c: use NAMESPACE_AT_PUT
	* libgst/lib.c: load VarBinding.st

2002-09-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: support push 8-bit value bytecodes
	* libgst/opt.c: support push 8-bit value bytecodes
	* libgst/interp-bc.inl: support push 8-bit value bytecodes
	* libgst/byte.c: support push 8-bit value bytecodes
	* libgst/byte.h: support push 8-bit value bytecodes
	* libgst/comp.c: support push 8-bit value bytecodes

	* libgst/interp.c: add the alwaysPreempt parameter
	to resume_process.  Callers and documentation adjusted.
	* libgst/interp-bc.inl: support single step mode.
	* libgst/interp-jit.inl: support single step mode.
	* libgst/prims.inl: add single stepping primitive.

2002-08-21  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.c: walk the OOP table forwards in
	sweep_pooled_contexts.  Correct off-by-one error
	in _gst_oop_index_valid.
	* libgst/prims.inl: added branch hits.  Fix bug
	where a too short replacement collection caused
	the String>>#replaceFrom:to:with:startingAt: primitive
	to succeed without making changes to the receiver.
	* lib-src/avltrees.c: removed uninitialized memory
	access (innocuous)

2002-08-20  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.c: pass SIGCHLD to the signal handler
	for asynchronous file polling, as it might reveal a
	POLLHUP event.

2002-08-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: accept -1 for isPipe in
	_gst_set_file_stream_file
	* libgst/prims.inl: try to lseek to the end of the
	file descriptor to check if it behaves like a pipe,
	and consider EINVAL the same as ESPIPE.  This hack
	makes FileDescriptor and FileStream consider /proc
	entries as pipes.

2002-08-18  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.y: give an error message if a binding
	to an undeclared class is used.

2002-08-14  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.5 (stable) released

	* libgst/lib.c: return `int' from _gst_init_smalltalk
	instead of exiting; give an error message if a
	non-existent file is given for -I.
	* libgst/gstpub.h: adjust documentation and prototype
	* main.c: adjust caller

2002-08-12  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0b (development) released

2002-08-07  Paolo Bonzini  (bonzini@gnu.org)

	*** Versions 2.0a (development) and 2.0.4 (stable) released

2002-07-24  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: added missing `break' statement

2002-07-22  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: don't load Browser.st

2002-07-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/floorl.c: new file
	* lib-src/ceill.c: new file
	* lib-src/sqrtl.c: new file
	* lib-src/frexpl.c: new file
	* lib-src/ldexpl.c: new file
	* lib-src/asinl.c: new file
	* lib-src/acosl.c: new file
	* lib-src/atanl.c: new file
	* lib-src/logl.c: new file
	* lib-src/expl.c: new file
	* lib-src/sinl.c: new file
	* lib-src/cosl.c: new file
	* lib-src/tanl.c: new file

2002-07-17  Paolo Bonzini  (bonzini@gnu.org)
  
  	*** Version 2.0.3 released

2002-07-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: don't do class checks on global variables
	(they refer to the associations!)

2002-07-11  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.2 released
	
2002-07-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: define _gst_object_copy instead of
	_gst_dictionary_copy
	* libgst/prims.inl: define a fast VMpr_Object_shallowCopy

2002-07-04  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.h: define MCF_ flags
	* libgst/prims.inl: define VMpr_BlockClosure_valueAndResumeOnUnwind
	and VMpr_ContextPart_continue
	* libgst/interp.c: complicate unwind_context, unwind_method,
	and define unwind_to to implement #ensure: correctly in the
	presence of non-local returns.
	* libgst/interp-bc.inl: use MCF_ flags
	* libgst/xlat.c: use MCF_ flags
	
2002-07-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lex.c: parse negative scaled decimal constants
	as negative; in general, parse them exactly without
	floating point errors.
	* libgst/prims.inl: large-integer primitives pass when
	they receive LargeIntegerZero
        * libgst/mpz.c: ensure the most significant limb of the
        gst_mpz objects is not zero
        * libgst/dict.c: fix GC bug in _gst_grow_identity_dictionary

2002-06-25  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/lib.c: load FloatD.st/FloatE.st/FloatQ.st

        * libgst/lex.c: parse floats as long doubles, distinguish
	FloatD/FloatE/FloatQ literals.
        * libgst/comp.c: distinguish FloatD/FloatE/FloatQ trees
        * libgst/tree.c: add TYPE parameter to _gst_make_float_constant
        * libgst/tree.h: adjust prototype, define CONST_FLOATD/CONST_FLOATE
	CONST_FLOATQ
        * libgst/gst.y: pass TYPE parameter to _gst_make_float_constant

        * libgst/cint.c: use FloatD/FloatE/FloatQ
        * libgst/callin.c: use FloatD/FloatE/FloatQ
        * libgst/dict.c: declared FloatD/FloatE/FloatQ
        * libgst/dict.h: declared FloatD/FloatE/FloatQ 
        * libgst/dict.inl: declared functions to box and unbox FloatE's
	and FloatQ's

        * libgst/mpz.c: defined _gst_mpz_get_ld
        * libgst/mpz.h: declared _gst_mpz_get_ld 
        * libgst/prims.inl: define primitives on FloatE/FloatQ
        * libgst/interp-bc.inl: change open-coded math operations to use
	FloatD

2002-06-28  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0.1 released
	
2002-06-27  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: don't require the image directory to
	be world-writable
	* libgst/xlat.c: fixed embarrassing syntax error
	
	* libgst/tree.c: use %O
	* libgst/sym.c: likewise
	* libgst/prims.inl: likewise
	* libgst/byte.c: likewise
	* libgst/comp.c: likewise
	* libgst/dict.c: likewise
	* libgst/dict.h: likewise
	* libgst/interp-bc.inl: likewise
	* libgst/interp.c: likewise
	* libgst/xlat.c: likewise

2002-06-26  Paolo Bonzini  (bonzini@gnu.org)

        * lib-src/asprintf.c: removed
        * lib-src/snprintf.c: removed

	* libgst/oop.c: remove printing functions
	* libgst/oop.h: likewise
	* libgst/dict.c: likewise
	* libgst/dict.h: likewise
	* libgst/sym.c: likewise
	* libgst/sym.h: likewise
	* libgst/print.c: move them here
	* libgst/print.h: and here
	* libgst/lib.c: call _gst_init_snprintfv

2002-06-25  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 2.0 released
	
2002-06-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: removed exceptionHandlers variable from
	the Process class.
	* libgst/lib.c: search in the class namespace before
	looking in the class pools

2002-06-13  Paolo Bonzini  (bonzini@gnu.org)
  
  	* libgst/lib.c: reformat help message

2002-06-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.inl: always define 32-bit and 64-bit
	int<->OOP conversion functions
	* libgst/cint.c: caller fixed
	* libgst/prims.inl: support 64-bit file offsets
	
	* libgst/interp-bc.inl: added more branch prediction hints

2002-06-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: define _gst_set_c_object
	* libgst/callin.h: declare _gst_set_c_object
	* libgst/gstpub.h: define setCObject in the VMProxy struct
	
2002-05-30  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/save.c: made some functions inline; remove amount
	of checks on wrong_endianness; store number of pointer
	instance variables in advance in the OOP if < 127.  A small
	improvement in image loading time, and an example of using
	F_COUNT (which will be used by GC in 2.1 to drop the
	recursive calls in the mark phase).

2002-05-30  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/save.c: loop in the used part of the OOP table only
	(+15% average speedup on image loading time).
	* libgst/dict.c: likewise
	* libgst/dict.h: adapted prototype of 
	_gst_init_dictionary_on_image_load

	* libgst/lex.c: use character literals for 1-char tokens
	* libgst/gst.y: likewise

	* libgst/jitpriv.h: new name of internal.h
	* libgst/xlat.c: include jitpriv.h
	* libgst/interp-jit.inl: include jitpriv.h instead of internal.h
	* libgst/gstpriv.h: don't include internal.h

2002-05-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: don't cache the VMPrimitives dictionary, it
	causes bugs.

2002-05-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.h: changed _gst_invoke_init_block to
	_gst_invoke_hook.
	* libgst/comp.c: trace exection of the hooks only if -E is
	specified; changed _gst_invoke_init_block to _gst_invoke_hook.
	* libgst/lib.c: use _gst_invoke_hook
	* libgst/oop.c: ditto
	* libgst/prims.inl: ditto
	* libgst/save.c: ditto
	
	* libgst/dict.c: keep dictionary sizes a power of two
	and scramble the bits
	* libgst/dict.inl: keep dictionary sizes a power of two
	and scramble the bits
	* libgst/prims.inl: declare a primitive to scramble the bits
	of a SmallInteger
	* libgst/sym.h: keep symbol table size a power of two
	* libgst/sym.c: use a simpler hash and scramble its bits
	
2002-05-14  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/mpz.c: fix multiple evaluation of arguments
	of BYTE_INVERT; work around misinterpretation of
	mpn_?shift documentation
	* libgst/oop.c: hardcode printing of infinite and nan
	values in _gst_print_object, to avoid false regressions
	due to libc differences

2002-05-12  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/comp.c: fire ObjectMemory events before
        and after evaluation in _gst_execute_statements
        * libgst/lib.h: declared _gst_kernel_initialized
        * libgst/lib.c: set _gst_kernel_initialized before
        invoking the #returnFromSnapshot event.

2002-05-11  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.6 released
	
2002-05-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.c: fix spurious error from my_close
	when stdin is passed on the command line (via -)

2002-05-08  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/internal.h: _gst_internal_funcs now const
	* libgst/interp.c: always mark thisContext (at worst,
	it is nil)
	* libgst/xlat.c: include lightning.h, removed by
	mistake when switching to gstpriv.h; add const in
	dcd_send_special

2002-05-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.h: objSize now an OOP
	* libgst/dict.inl: likewise
	* libgst/xlat.c: likewise
	* libgst/save.c: likewise
	* libgst/oop.c: likewise
	* libgst/mpz.c: likewise
	* libgst/interp.c: likewise
	* libgst/dict.c: likewise
	* libgst/comp.c: likewise

2002-05-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gstpriv.h: declare macros for branch prediction hints
	* libgst/interp-bc.inl: use them
	* libgst/interp-jit.inl: use them
	* libgst/interp.c: use them
	* libgst/interp.inl: use them
	* libgst/md-config.h: use them
	* libgst/oop.c: use them
	* libgst/oop.inl: use them
	
	* libgst/oop.c: allocate objects outside the main heap
	in _gst_alloc_obj
	* libgst/oop.h: declare _gst_big_objects_threshold
	* libgst/prims.inl: added primitives to tune threshold
	for in-heap allocation
	
	* libgst/oop.c: modify calling convention for _gst_alloc_obj,
	in preparation for allocating outside the main heap
	* libgst/oop.h: declaration adjusted.
	* libgst/dict.c: callers adjusted.
	* libgst/oop.c: callers adjusted.

	* libgst/dict.inl: modify calling convention for
	instantiation functions, to account for the change to
	_gst_alloc_obj and in preparation for allocating outside
	the main heap.
	* libgst/interp.c: callers adjusted.
	* libgst/comp.c: callers adjusted.
	* libgst/callin.c: callers adjusted.
	* libgst/sym.c: callers adjusted.
	* libgst/dict.c: callers adjusted.
	* libgst/prims.inl: callers adjusted.

2002-05-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: move C...Size et al. into CSymbols,
	refer to CSymbols as to a pool dictionary of ByteArray,
	CObject, Float, Integer.  Drop class comments, they are
	not needed here.  Create a RegressionTesting global
	variable that suppresses more sources of variance.

2002-04-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/avltrees.c: traverse correctly when
	avl_left && !avl_right
	* lib-src/rbtrees.c: likewise

	* libgst/dict.c: don't set writePtr and writeEnd
	for FileDescriptors in _gst_set_stream_file

2002-04-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: return NaN when transcendental
	functions fail.  Removed VMpr_LargeInteger_divide.
	
2002-04-14  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.5 released
	
2002-04-13  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: print a backtrace on SIGUSR1
	* libgst/oop.c: gc_running -> _gst_gc_running
	* libgst/oop.h: declare _gst_gc_running
	
2002-04-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-bc.inl: properly check for overflows on
	bitshifts (used to return 0 instead of 16r-80000000)
	* libgst/prims.inl: likewise

2002-03-27  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/mpz.c: new file
	* libgst/mpz.h: new file
	* libgst/prims.inl: implemented primitives for large integers
	
2002-03-25  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/md-config.h: added cacheline definitions
	* libgst/interp.c: added cacheline definitions
	* libgst/oop.c: added cacheline definitions
	* libgst/xlat.c: added cacheline definitions

	* libgst/interp.inl: use inttypes.h rather than stdint.h

2002-03-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/snprintf.c: new file
	* libgst/events.c: don't include sys/select.h, we don't need it
	* libgst/gstpub.h: don't include sys/select.h, we don't need it
	* libgst/sysdep.c: support HP/UX's FIOSSAIOSTAT and
	FIOSSAIOOWN ioctls to setup asynchronous I/O
	* libgst/input.c: check for EINTR when reading from a file
	* libgst/prims.inl: check for EINTR when reading from a file

        * libgst/lex.c: skip _ inside numeric literals

2002-03-17  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/lib.c: updated list of files for virtual filesystem layer
        * libgst/prims.inl: implement the PRIM_MK_TEMP file operation.

2002-03-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.h: added _gst_push_stream_oop
	* libgst/input.c: implement stream operations for
	arbitrary OOP's.
	* libgst/prims.inl: remove checks for String-ness
	in compilation primitives.

2002-03-12  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.4 released
	
2002-03-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.h: _gst_gc_flip -> _gst_scavenge,
	_gst_minor_gcflip -> _gst_minor_scavenge
	* libgst/oop.c: likewise
	* libgst/oop.inl: likewise
	* libgst/save.c: likewise
	* libgst/prims.inl: likewise
	* libgst/interp.c: likewise

	* libgst/oop.c: GC flip -> scavenging
	
2002-02-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.h: removed private stuff
	* libgst/gstpriv.h: private stuff from gst.h + inclusion
	of all the other headers
	* byte.c: include gstpriv.h
	* callin.c: include gstpriv.h
	* cint.c: include gstpriv.h
	* comp.c: include gstpriv.h
	* dict.c: include gstpriv.h
	* events.c: include gstpriv.h
	* gst.tab.c: include gstpriv.h
	* heap.c: include gstpriv.h
	* input.c: include gstpriv.h
	* interp.c: include gstpriv.h
	* lex.c: include gstpriv.h
	* lib.c: include gstpriv.h
	* oop.c: include gstpriv.h
	* opt.c: include gstpriv.h
	* save.c: include gstpriv.h
	* str.c: include gstpriv.h
	* sym.c: include gstpriv.h
	* sysdep.c: include gstpriv.h
	* tree.c: include gstpriv.h
	* xlat.c: include gstpriv.h

2002-02-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: fixed a code generation bug for {} array
	constructors (two consecutive updates of the stack pointer).
	
2002-02-26  Paolo Bonzini  (bonzini@gnu.org)

	Named primitives: interpreter changes
	-------------------------------------
	* libgst/prims.inl: implement named primitives (vs. numbered)
	* libgst/interp.h: reflect changes in the interface for named
	primitives
	* libgst/interp-bc.inl: call the appropriate named primitive
	in MAYBE_PRIMITIVE
	* libgst/interp.c: include prims.inl before interp-bc.inl or
	interp-jit.inl
	* libgst/internal.h: include VMpr_BlockClosure_blockCopy
	in the internal functions
	* libgst/interp-jit.inl: include VMpr_BlockClosure_blockCopy
	in the internal functions
	* libgst/xlat.c: adapt to changes in the interface for named
	primitives

	Named primitives: compiler changes
	----------------------------------
	* libgst/gst.y: declare primitive as type <sval>
	* libgst/tree.h: primitiveIndex -> primitiveName
	* libgst/tree.c: likewise
	* libgst/dict.h: declared _gst_resolve_primitive_name
	* libgst/dict.c: added _gst_resolve_primitive_name and
	init_primitives_dictionary
	* libgst/comp.c: use _gst_resolve_primitive_name

	Named primitives: image loading
	-------------------------------
	* libgst/dict.c: added prepare_primitive_number_map, removed
	bit of init_runtime_objects to initialize the symbols and
	calling _gst_init_symbols instead.
	* libgst/sym.c: added _gst_init_symbols, symbol_list not
	extern anymore
	* libgst/sym.h: added _gst_init_symbols, symbol_list not
	extern anymore
	* libgst/comp.c: added _gst_restore_primitive_number
	* libgst/comp.h: declared _gst_restore_primitive_number
	
2002-02-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: implemented _gst_register_oop_array & co
	* libgst/callin.h: declared _gst_register_oop_array & co
	* libgst/gstpub.h: added registerOOPArray to the VMProxy
	* libgst/comp.c: use pointers rather than indices to implement
	the literal vector, to be compatible with _gst_register_oop_array's
	conventions.  Use _gst_register_oop_array to register the
	literal vector, in init_compiler.
	* libgst/oop.c: replaced mark_incubator_oops with a call to
	_gst_register_oop_array.

	* libgst/dict.c: removed CFunctionDescs from the list of pool
	dictionaries for Object

	* libgst/interp-bc.inl: fixed a rare bug by invalidating
	last_primitive before exiting the interpreter
	
2002-02-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/avltrees.c: new file
	* lib-src/avltrees.h: new file
	* lib-src/rbtrees.c: new file
	* lib-src/rbtrees.h: new file
	* libgst/cint.c: use AVL trees for the C function registry;
	get rid of _gst_init_cfunc_vec.
	* libgst/callin.c: use red-black trees for the OOP registry;
	get rid of _gst_init_oopregistry.
	* libgst/lib.c: get rid of _gst_init_oopregistry
	* libgst/callin.h: get rid of _gst_init_oopregistry

	* libgst/dict.c: register the Smalltalk dictionary in
	init_runtime_objects
	* libgst/comp.c: keep _gst_this_class & co. into the registry.
	Got rid of _gst_mark_compile_context.
	* libgst/comp.h: removed _gst_mark_compile_context.
	* libgst/events.c: removed _gst_mark_events_semaphores, use
	the registry instead.
	* libgst/events.h: removed _gst_mark_events_semaphores
	* libgst/interp.c: don't call _gst_mark_events_semaphores
	* libgst/oop.c: remove the hooks in mark_oops that have been
	replaced by the registry (now that it is a tree it is also
	faster)

	* libgst/interp.h: declared _gst_async_signal_and_unregister
	* libgst/gstpub.h: declared asyncSignalAndUnregister in
	the VMProxy
	* libgst/interp.c: implemented _gst_async_signal_and_unregister
	* libgst/interp-bc.inl: added glue for _gst_async_signal_and_unregister
	* libgst/interp-jit.inl: added glue for _gst_async_signal_and_unregister
	
2002-02-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lex.c: document the functions and variables
	* libgst/lex.h: likewise
	* libgst/input.c: likewise
	* libgst/input.h: likewise
	* libgst/sym.c: likewise
	* libgst/sym.h: likewise
	* libgst/sysdep.c: likewise
	* libgst/sysdep.h: likewise

	* libgst/sym.c: allow _ for variable names in the bootstrapping
	declarations.
	
2002-02-22  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/oop.c: remove the routines to disable the GC
	* libgst/oop.h: remove the routines to disable the GC
	* libgst/save.c: remove the calls to disable the GC since
	the variable was never checked

	* libgst/oop.c: document the functions and variables
	* libgst/oop.h: likewise
	* libgst/oop.inl: likewise

2002-02-21  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: document the functions and variables
	* libgst/comp.inl: likewise
	* libgst/byte.c: likewise
	* libgst/byte.h: likewise
	* libgst/dict.inl: likewise
	* libgst/dict.c: likewise
	* libgst/dict.h: likewise

2002-02-20  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: document the functions and variables
	* libgst/comp.h: likewise
	* libgst/input.c: flush stdout after printing the prompt,
	if readline is not used.

2002-02-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: remove conditional on PICKY_VA_ARG,
	ANSI says it should really be picky (i.e. not accept
	a char type)
	
	* libgst/interp.inl: try to use long long or intmax_t
	to check overflow on multiplication

	* libgst/interp-jit.inl: when refreshing the native IPs,
	special case the termination method so that its native
	instruction pointer is the special code to yield control
	back to _gst_interpret.

	* libgst/interp.h: document the functions and variables
	* libgst/interp-bc.inl: likewise
	* libgst/interp-jit.inl: likewise
	* libgst/prims.inl: likewise
	* libgst/opt.c: likewise
	* libgst/opt.h: likewise
	* libgst/callin.c: likewise
	* libgst/callin.h: likewise
	* libgst/cint.c: likewise
	* libgst/cint.h: likewise

2002-02-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: document the functions and variables

2002-02-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/save.c: document the functions and variables
	* libgst/save.h: likewise
	* libgst/str.c: likewise
	* libgst/str.h: likewise
	* libgst/events.c: likewise
	* libgst/events.h: likewise
	* libgst/tree.c: likewise
	* libgst/tree.h: likewise
	* libgst/heap.c: likewise
	* libgst/heap.h: likewise
	* libgst/lib.c: likewise
	* libgst/lib.h: likewise
	* libgst/gst.h: likewise
	* libgst/gstpub.h: likewise
	
	* libgst/byte.h: remove leading double underscores from the guard
	* libgst/callin.h: likewise
	* libgst/cint.h: likewise
	* libgst/comp.h: likewise
	* libgst/dict.h: likewise
	* libgst/events.h: likewise
	* libgst/gst.h: likewise
	* libgst/gst.tab.h: likewise
	* libgst/gstpub.h: likewise
	* libgst/heap.h: likewise
	* libgst/input.h: likewise
	* libgst/internal.h: likewise
	* libgst/interp.h: likewise
	* libgst/lex.h: likewise
	* libgst/lib.h: likewise
	* libgst/md-config.h: likewise
	* libgst/memzero.h: likewise
	* libgst/oop.h: likewise
	* libgst/opt.h: likewise
	* libgst/save.h: likewise
	* libgst/str.h: likewise
	* libgst/sym.h: likewise
	* libgst/sysdep.h: likewise
	* libgst/tree.h: likewise
	* libgst/xlat.h: likewise
	
	* libgst/comp.inl: remove the useless guard
	* libgst/dict.inl: likewise
	* libgst/interp.inl: likewise
	* libgst/oop.inl: likewise

2002-02-07  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: show only the last copyright year.
	
	* libgst/events.c: major reengineering to avoid race
	conditions and dangling pointers... gee, how bad the
	code was before this! :-(
	* libgst/sysdep.c: to avoid cluttering the straces,
	don't set the same signal handlers as the last time
	in _gst_set_file_interrupt
	* libgst/interp-bc.inl: protect interrupts while
	accessing async_queue_index (even though it is volatile)
	* libgst/interp-jit.inl: likewise

2002-01-29  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.3 released.

	* libgst/opt.c: convert arguments to qsort and bsearch
	to accept two void *'s.
	* libgst/input.c: likewise

2002-01-23  Paolo Bonzini  <bonzini@gnu.org>

	* main.c: converted to ANSI C and to the GNU
	coding standards
	* libgst/byte.c: likewise
	* libgst/callin.c: likewise
	* libgst/cint.c: likewise
	* libgst/comp.c: likewise
	* libgst/dict.c: likewise
	* libgst/events.c: likewise
	* libgst/gst.tab.c: likewise
	* libgst/heap.c: likewise
	* libgst/input.c: likewise
	* libgst/interp.c: likewise
	* libgst/lex.c: likewise
	* libgst/lib.c: likewise
	* libgst/oop.c: likewise
	* libgst/opt.c: likewise
	* libgst/save.c: likewise
	* libgst/str.c: likewise
	* libgst/sym.c: likewise
	* libgst/sysdep.c: likewise
	* libgst/tree.c: likewise
	* libgst/xlat.c: likewise
	* libgst/byte.h: likewise
	* libgst/callin.h: likewise
	* libgst/cint.h: likewise
	* libgst/comp.h: likewise
	* libgst/dict.h: likewise
	* libgst/events.h: likewise
	* libgst/gst.h: likewise
	* libgst/gst.tab.h: likewise
	* libgst/gstpub.h: likewise
	* libgst/heap.h: likewise
	* libgst/input.h: likewise
	* libgst/internal.h: likewise
	* libgst/interp.h: likewise
	* libgst/lex.h: likewise
	* libgst/lib.h: likewise
	* libgst/md-config.h: likewise
	* libgst/memzero.h: likewise
	* libgst/oop.h: likewise
	* libgst/opt.h: likewise
	* libgst/save.h: likewise
	* libgst/str.h: likewise
	* libgst/sym.h: likewise
	* libgst/sysdep.h: likewise
	* libgst/tree.h: likewise
	* libgst/xlat.h: likewise
	* libgst/comp.inl: likewise
	* libgst/dict.inl: likewise
	* libgst/interp-bc.inl: likewise
	* libgst/interp-jit.inl: likewise
	* libgst/interp.inl: likewise
	* libgst/oop.inl: likewise
	* libgst/prims.inl: likewise
	
2002-01-22  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.y: signal a warning if self, super, true, false,
	nil, or thisContext are sent.  General reformatting of the
	source code.

2002-01-18  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: removed initialization blocks

2002-01-17  Nigel Williams  (nigelw@wizardis.com.au)

	* libgst/dict.c: added atEnd variable to FileDescriptor
	* libgst/prims.inl: provide a primitive to check if a
	descriptor is a pipe or a file.

	* libgst/dict.c: added timeSlice variable to ProcessorScheduler
	* libgst/events.c: pass a third parameter to signalAfter
	* libgst/interp-bc.inl: call setPreemptionTimer once the timer
	has been fired and acknowledged
	* libgst/interp-jit.inl: call setPreemptionTimer once the timer
	has been fired and acknowledged
	* libgst/interp.c: new functions related to preemptive
	multitasking
	* libgst/interp.h: added timeSlice variable to ProcessorScheduler
	* libgst/sysdep.h: added support for process-time timers (like
	ITIMER_VIRTUAL)
	* libgst/sysdep.c: added support for process-time timers (like
	ITIMER_VIRTUAL)
	
2002-01-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: ensure that the image path is the directory
	from which we loaded the image, rather than the default image
	path.

2002-01-04  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.2 released
	
2002-01-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: add the Source class variable to the Random
	class.
	* libgst/input.c: don't use readline unless stdin is a TTY.
	* libgst/lib.c: changed banner to "GNU Smalltalk ready"
	(lowercase r)

2001-12-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/events.c: poll until there are no pending events

2001-11-20  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.96.1 released
	
2001-11-13  Paolo Bonzini  (bonzini@gnu.org)

        * libgst/gst.y: implement #(true false nil) as per the ANSI
	standard.

2001-10-24  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.c: define O_ASYNC as FASYNC if not found.

2001-10-17  David Forster  (dforste@qwest.net)

	* libgst/cint.c: add uInt and uLong support for C interface.
	Change longType return to use fromCLong.
	* libgst/sym.c: add uIntSymbol and uLongSymbol.

2001-10-16  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.95.5 released.
	
	* libgst/lib.c: observe quietExecution when loading
	.stinit and .stpre.

2001-10-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: fixed bugs after applying the two
	patches below.
	
2001-10-06  Nigel Williams  (nigelw@elder-gods.net)

	* libgst/lib.c: show error message if file not found
	
2001-08-28  Carlo Dapor  (catull_us@yahoo.com)

	* libgst/lex.c: reset floating point exception mask
	under FreeBSD.
	* libgst/lib.c: switch to getopt_long for parsing
	long command line options.
	
2001-07-14  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.h: gee, what a hiatus!  Fixed for C++.
	* libgst/gstpub.h: likewise
	
2001-06-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.h: defined PRIM_CHECK_INTERRUPT
	* libgst/prims.inl: added PRIM_CHECK_INTERRUPT
	where required
	* libgst/xlat.c: emitInterruptCheck called from
	emitPrimitive only if PRIM_CHECK_INTERRUPT
	
2001-06-13  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: create the IPMap when translating.
	Defined mapVirtualIP.  Store the IP at every possible
	synchronization point (emitInterruptCheck).
	* libgst/xlat.h: declared mapVirtualIP.

	* libgst/str.c: declared addBufData
	* libgst/str.h: defined addBufData
	
	* libgst/xlat.c: generate an interrupt check as part of
	the prolog rather than of the return bytecodes.
	
2001-06-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-jit.inl: defined refreshNativeIPs.
	* libgst/interp.c: returnIP --> nativeIP
	* libgst/interp.h: returnIP --> nativeIP
	* libgst/dict.c: returnIP --> nativeIP
	* libgst/save.c: reset a context's nativeIP upon image load.
	
2001-06-08  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.c: open the slave pty before forking
	
2001-06-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/md-config.h: define BRANCH_REGISTER for every
	architecture
	* libgst/interp-bc.inl: put the prefetched address into
	a branch register.

	* libgst/dict.c: include sysdep.h
	* libgst/input.c: removed unused variable in pushUNIXFile
	* libgst/prims.inl: removed unused variable in primitive 254
	* libgst/sysdep.h: declared fullWrite
	
2001-06-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: getMethodBase became initTranslator
	* libgst/xlat.h: likewise
	* libgst/interp.c: got rid of the nativeBase
	* libgst/interp-jit.inl: got rid of the nativeBase

	* libgst/sysdep.c: set the CLOEXEC flag in openFile
	
2001-06-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/events.c: use poll(2) instead of select(2),
	I am told it is more scalable.
	* libgst/input.c: likewise, for coherency.
	* lib-src/poll.c: provide select-based implementation of poll
	* lib-src/poll.h: to be used instead of sys/poll.h
	
2001-05-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.c: use ptys to create a pipe; when
	setting file interrupt with SIOCSGRP and FIOASYNC,
	check that both ioctls succeed.

2001-05-24  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: make unwindMethod return whether
	the return was successful
	* libgst/interp-bc.inl: send #badReturnError if
	return from method was unsuccessful
	* libgst/xlat.c: likewise

	* libgst/interp-jit.inl: added a comment re. the only
	serious bug remaining.

2001-05-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/heap.c: _WIN32 --> WIN32
	* libgst/gst.h: define WIN32 if __CYGWIN__ or __CYGWIN32__
	* libgst/sysdep.c: _WIN32 --> WIN32

2001-05-22  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: added support for inlined primitives
	* libgst/prims.inl: marked a few primitives as inlined
	* libgst/dict.inl: added accessors for the ISP_ISWORDS
	bit.
	
2001-05-20  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: remove calls to moncontrol; will be
	replaced by new profiling stuff.
	* libgst/prims.inl: temporarily embed the moncontrol
	primitive into #if 0.

2001-05-17  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: recycle existing std{in,out,err}.
	* libgst/input.c: wait for a character to be available
	before returning to Readline.
	* libgst/prims.inl: reset errno to 0 after calling
	lseek.
	
2001-05-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-jit.inl: in sendMessageInternal force
	a call to getNativeCode upon a cache miss
	
2001-05-11  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: fixes for PowerPC (sizeof(jit_insn) > 1)
	
2001-05-04  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/cint.c: support selfSmalltalk and variadicSmalltalk
	as additional parameter types
	* libgst/sym.c: defined selfSmalltalkSymbol and
	variadicSmalltalkSymbol
	* libgst/sym.h: declared selfSmalltalkSymbol and
	variadicSmalltalkSymbol
	
2001-04-30  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: fixed buffer overflows involving
	oopVec.
	
2001-04-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/sysdep.h: fixed isFinite, it reported -2.0 as
	infinite!
	
	* libgst/callin.h: declared basicSize
	* libgst/callin.c: defined basicSize
	* libgst/gstpub.h: added basicSize to the InterpreterProxy
	
2001-04-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/dup2.c: new file
	
2001-04-23  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: extrapolated a part of it into events.c,
	include events.h
	* libgst/prims.inl: turn some primitives into calls to
	functions in events.c
	* libgst/events.c: new file
	* libgst/events.h: new file

	* libgst/interp.h: declared syncWait
	* libgst/interp.c: defined syncWait from primitive 86's code
	* libgst/prims.inl: primitive 86 now calls syncWait
	* libgst/gstpub.h: declared syncWait in the interpreterProxy
	* libgst/callin.c: likewise

	* libgst/sysdep.c: use socketpair to create a pipe
	
2001-04-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.h: declared fileDescriptorClass
	* libgst/dict.c: declared fileDescriptorClass
	* libgst/lib.c: load FileDescr.st

	* libgst/opt.c: fix incorrect peephole optimization: of 
	two equal `pop/store into instance variable of new stack top'
	bytecodes, the second became a `duplicate stack top' bytecode

2001-04-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: use incAddOOP everywhere instead of
	registerOOP.  Added objectAlloc to the interpreterProxy
	* libgst/callin.h: declared objectAlloc in the interpreterProxy
	* libgst/cint.c: invokeCFunction now includes an incSavePointer
	and incRestorePointer pair.
	* libgst/gst.h: make incAddOOP a single statement instead
	of a C block.
	
	* libgst/cint.c: in pushSmalltalkObj, use the incubator rather
	than the registry.
	* libgst/cint.h: removed declaration of enableGC, since the above
	change left it unused.
	* libgst/prims.inl: removed primitive 264 (#enableGC:)
	
2001-04-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: declared objectMemoryClass
	* libgst/dict.h: declared objectMemoryClass
	* libgst/lib.c: load ObjMemory.st, not initialize.st
	* libgst/save.c: raise ObjectMemory events
	* libgst/comp.c: raise ObjectMemory events
	* libgst/oop.c: raise ObjectMemory events
	* libgst/prims.inl: raise ObjectMemory events
	
2001-03-31  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: implemented byteArrayToOOP and OOPToByteArray
	* libgst/gstpub.h: declared byteArrayToOOP and OOPToByteArray in
	the VMProxy.
	* libgst/sysdep.c: removed code to set the LANG environment
	variable on Win32 systems.
	
2001-03-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: added an `access' parameter to setFileStreamFile
	* libgst/prims.inl: pass the `access' parameter to setFileStreamFile
	from primitive 254
	
2001-03-20  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: set up FileStream for new buffering scheme,
	and updated setFileStreamFile.
	* libgst/prims.inl: implemented primitive 254 for new buffering
	scheme.  Incorporated primitives 247/248 (file-in) into 254.
	
2001-03-17  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.c: implemented pushUNIXFile & co. in terms
	of file descriptors.
	* libgst/prims.inl: implement FileStream in terms of file
	descriptors.
	* libgst/save.c: use file descriptors.
	* libgst/sysdep.c: modified openFile/openPipe to use
	file descriptors.
	
2001-03-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: bindings are simple oopConsts now
	* libgst/tree.c: resolve bindings as oopConsts
	* libgst/tree.h: removed bindingConst
	* libgst/gst.y: raise an error on an invalid binding

	* libgst/comp.c: initCompiler is now public
	* libgst/comp.h: initCompiler is now public
	* libgst/lib.c: call initCompiler

2001-03-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/md-config.h: fixed typo in register allocation
	for the SPARC.

2001-03-01  Dirk Sondermann <d.sondermann@freenet.de>

	* libgst/md-config.h: disable register allocation on the
	SPARC (possibly temporary change).
	
2001-02-23  Paolo Bonzini  (bonzini@gnu.org)

	*** Released version 1.95.3

2001-02-19  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.h: declare sendMethod.
	* libgst/interp.c: added sendMethod to list of routines
	implemented by plug-ins.
	* libgst/interp-bc.inl: added sendMethod.
	* libgst/interp-jit.inl: added sendMethod.
	* libgst/prims.inl: support sending methods in the
	#perform: and #perform:withArguments: primitive.

	* libgst/comp.c: add `install' parameter to compileMethod;
	set latestCompiledMethod in compileMethod; use sendMethod
	in executeStatements.
	* libgst/gst.y: pass `install' parameter to compileMethod
	
2001-02-17  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/input.c: made from complete.c and part of lex.c
	* libgst/input.h: made from complete.h and part of lex.h
	* libgst/gst.y: include input.h
	* libgst/byte.c: include input.h instead of lex.h
	* libgst/cint.c: ditto
	* libgst/comp.c: ditto
	* libgst/dict.c: ditto
	* libgst/heap.c: ditto
	* libgst/input.c: ditto
	* libgst/interp.c: ditto
	* libgst/lex.c: ditto
	* libgst/lib.c: ditto
	* libgst/oop.c: ditto
	* libgst/opt.c: ditto
	* libgst/sym.c: ditto
	* libgst/tree.c: ditto

	* libgst/comp.c: removed emacsProcess from here
	* libgst/tree.c: removed hadError from here
	* libgst/input.c: moved emacsProcess and hadError here
	
	* libgst/comp.h: removed emacsProcess from here
	* libgst/tree.h: removed hadError from here
	* libgst/input.h: moved emacsProcess and hadError here

2001-02-17   Dirk Sondermann <d.sondermann@freenet.de>

	* libgst/heap.c: fixed for Solaris
	
2001-02-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/complete.c: new file
	* libgst/complete.h: new file
	* libgst/lex.c: moved initializeReadline to readline.c
	* libgst/lib.c: call initializeReadline after we loaded the
	image, because addAllSymbolCompletions needs the full symbol table.
	* libgst/sym.c: call addSymbolCompletion in internCountedString,
	added addAllSymbolCompletions.
	* libgst/sym.h: declared addAllSymbolCompletions
	
2001-02-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/cint.c: made invokeCRoutine return whether the
	call-out was successful.
	* libgst/cint.h: made invokeCRoutine return a boolean.
	* libgst/prims.inl: on invalid C call-outs, primitive 255
	fails.
	
2001-02-14  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: in primitive 255 (C call-out) check
	that we were not called from the at-cache.
	
2001-02-13  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: keep dictionaries no more than 75% full,
	* libgst/dict.h: ditto

	* libgst/dict.c: keep dictionary sizes prime (new function
	newNumFields).

2001-02-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.h: moved F_FINALIZE into the runtime flags
	(not preserved between the time an image is saved and
	the time it is loaded)
	
2001-02-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lex.c: pushReadlineString became pushStdinString,
	and calls pushUNIXFile if emacsProcess is true or readline
	is not available
	* libgst/lex.h: declare pushStdinString
	* libgst/lib.c: instead of using #ifdef to decide between
	pushReadlineString or pushUNIXFile, use pushStdinString.
	
2001-02-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: added idToOOP/OOPToId, declaration of
	interpreterProxy
	* libgst/gstpub.h: declared idToOOP/OOPToId, VMProxyStruct
	* libgst/callin.h: moved old contents of gstpub.h here

	* libgst/lib.c: don't call gst_dld_init
	* libgst/cint.c: don't call initUserCFuncs; merged with
	dld_gst.c.  In gst_dld_open automatically call gst_initModule
	for the shared library; and always use libltdl.
	* libgst/cfuncs.c: removed.
	* libgst/dld*: removed.
	* libgst/cint.c: search the cFuncInfo array backwards,
	so that new definitions override the old ones.
	
2001-01-31  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/cint.c: declared a wrapper around opendir, which
	returns ENOSYS under Linux!  Also declared isExecutable
	* libgst/lib.c: load OtherArrays.st
	* libgst/sysdep.h: declared fileIsExecutable
	* libgst/sysdep.c: defined fileIsExecutable
	
2001-01-31  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: compile bindingConsts.
	* libgst/gst.y: added #{...} literals
	* libgst/sym.c: defined findVariableBinding
	* libgst/sym.h: declared findVariableBinding
	* libgst/tree.c: defined makeBindingConstant
	* libgst/tree.h: declared makeBindingConstant and bindingConst

2001-01-30  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: define KernelFileSystemPath in
	initDictionaryOnImageLoad, and KernelFilePath in
	initDictionary

2001-01-30  Paolo Bonzini  (bonzini@gnu.org)

	*** Released version 1.95.1
	
2001-01-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-bc.inl: define different optimization levels
	depending on REG_AVAILABILITY.
	* libgst/dict.inl: include md-config.h instead of register.h
	* libgst/interp.c: include md-config.h instead of register.h
	* libgst/md-config.h: new name of register.h

2001-01-14  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: use incubator in makeBlockClosure.
	* libgst/oop.inl: isObjAddr returns false if the address lies beyond
	the allocPtr (used to be beyond the maxPtr)

2001-01-12  Paolo Bonzini  (bonzini@wbkst15.mach.uni-karlsruhe.de)

	* libgst/interp-bc.inl: fixed pipelining bugs; added more caching
	opportunities

2001-01-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp-bc.inl: implementation of pipelining
	* libgst/interp.c: defined and explained PIPELINING

2001-01-08  Paolo Bonzini  (bonzini@wbkst15.mach.uni-karlsruhe.de)

	* libgst/dict.inl: added cast to arrayNew to work on 64-bit machines
	* libgst/gst.h: removed warning for 64-bit machines
	* libgst/interp.c: fixed prepareContext to work on 64-bit machines
	(num is now a long)
	* libgst/oop.c: make data spaces twice as big on 64-bit machines
	* libgst/oop.h: make data spaces twice as big on 64-bit machines
	* libgst/register.h: removed warning for unsupported architectures,
	was much more a burden than I had expected.

2000-12-16  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/opt.c: finished first draft of type inferencing.
	* libgst/xlat.c: adapted to use opt.c; nothing was broken for
	disabled type inferencing.

2000-12-05  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/heap.c: moved the process of guessing the heap base from
	configure.in to here.
	* libgst/sysdep.h: declared SigHandler
	* libgst/sysdep.c: made setSignalHandler return the previous signal
	handler.

2000-11-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: changed bug reporting address

2000-10-14  GertJan Kersten (GertJan.Kersten@bolesian.nl)

	* libgst/cint.c: fix brokenness in Cygwin's stat and chdir
	(which set errno even if the function succeeds).

2000-09-12  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/opt.c: started implementation of type inferencing
	(have basic block detection now).  Finally succeded in
	passing Physics yesterday.

2000-09-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.h: added declarations for primitive attributes. 
	* libgst/prims.inl: added primitive attributes.
	* libgst/xlat.c: use primitive attributes in emitPrimitive.

2000-09-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: added discardNativeCode and modified other
	function to use the `discarded' list.
	* libgst/xlat.h: added declaration for discardNativeCode.
	* libgst/dict.c: in identityDictionaryAtPut, return the
	old value associated to the key.
	* libgst/comp.c: include xlat.h; call discardNativeCode on
	the old method if a method is replacing another.
	* libgst/prims.inl: primitive 90, instead of returning the
	native code for a method, discards the method (completely
	different semantics -- but the old one had no use since
	the Smalltalk program had no interesting use of the result).

2000-09-09  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/byte.c: modified bytecode 134 for pop-into-array
	* libgst/byte.h: modified bytecode 134 for pop-into-array
	* libgst/interp-bc.inl: modified bytecode 134 for pop-into-array
	* libgst/opt.c: modified computeStackPositions for pop-into-array
	* libgst/xlat.c: modified bytecode 134 for pop-into-array,
	added gen_popIntoArray

	* libgst/comp.c: added compileArrayConstructor and modified
	according to the changes to tree.c below
	* libgst/lex.c: recognize { and }
	* libgst/gst.y: recognize { ... } syntax
	* libgst/tree.c: removed charConst, symbolConst -> oopConst,
	implemented makeArrayConstructor
	* libgst/tree.h: declared makeArrayConstructor, added
	arrayConstructorType, removed charConst, symbolConst -> oopConst

2000-09-08  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: method cache is no longer static; moved
	MethodCacheEntry declaration to interp.h.  Also found bug
	in lookupMethod which prevented the method cache from being
	fully exploited (startingClassOOP was set to the methodClass).
	* libgst/interp.h: declared MethodCacheEntry
	* libgst/interp.inl: defined checkSendCorrectness
	* libgst/prims.inl: used checkSendCorrectness

	* libgst/xlat.c: included compilation of == into gen_intComparison
	(now called gen_binaryBool); renamed gen_intOperation to
	gen_binaryInt and TREE_ARIT_* to TREE_BINARY_*

2000-09-07  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.8.3 released

	* libgst/dict.c: removed ByteMemory and WordMemory declarations.
	* libgst/dict.h: removed ByteMemory and WordMemory declarations.
	* libgst/lib.c: don't load ByteMemory and WordMemory definitions.
	* libgst/prims.inl: removed ByteMemory primitives.

2000-09-07  Nigel Williams  (nigelw@wizardis.com.au)

	* libgst/cint.c: allow to pass nil for stringOut, byteArray and
	byteArrayOut too.

2000-09-01  Nigel Williams  (nigelw@wizardis.com.au)

	* libgst/prims.inl: corrected class check for primitive 203/204

2000-08-15  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/opt.c: added stub implementation of inferSmallIntegerOps.
	* libgst/opt.h: declare inferSmallIntegerOps and the constants it uses.
	* libgst/xlat.c: added support for inferSmallIntegerOps and ability
	to omit overflow checks if the result of an inlined operation is
	known to be a SmallInteger.

2000-08-08  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: renamed compileSubexpressionWithGoto to
	compileSubexpressionAndJump
	* libgst/dict.inl: only have 8 case's (instead of 9) in nilFill
	* libgst/interp.c: only have 8 case's (instead of 9) in prepareContext
	* libgst/save.c: moved most of loadFromFile to loadSnapshot; removed
	goto statements (my life is passing through a phase of structured
	programming mania).

2000-08-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/byte.c: moved part to opt.c
	* libgst/byte.h: moved part to opt.h
	* libgst/opt.c: created from byte.c.  As the JIT compiler will
	get more sophisticated this part is going to get bigger.
	* libgst/opt.h: created from byte.h

	* libgst/comp.c: include opt.h.  Also, don't generate unreachable
	jumps in `... ifTrue: [ ^true ]' (or an analogous pattern with
	#ifTrue:ifFalse:).  This pleases computeStackPositions enough
	to run the Prolog and Lisp interpreters.
	* libgst/xlat.c: include opt.h

	* libgst/gst.h: added F_FIXED.
	* libgst/oop.h: declared makeFixedOOP.
	* libgst/oop.c: added makeFixedOOP, deal with fixed objects
	in prepareForSweep.
	* libgst/prims.inl: added primitive 170-172 to deal with fixed
	objects.
	* libgst/save.c: always clear F_RUNTIME flags, not only when
	the endianness is wrong!!! This caused the GC to try to release
	the native code version of methods that had indeed been compiled
	when the image was saved, but were not compiled when GC was
	invoked.  Also implemented saving F_FIXED objects.

2000-07-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/lib.c: allow usage of Undeclared in the kernel's source

2000-07-04  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/heap.c: support MAP_ANON and MAP_ANONYMOUS (thanks to
	John David Anglin)
	* libgst/oop.c: in gcFlip, modify numFreeOOPs so that allocOOPs
	allocates its OOPs merrily, even if we're below the low-water
	threshold.
	* libgst/oop.h: defined LOW_WATER_OOP_THRESHOLD
	* libgst/oop.inl: in allocOOP, check low-water condition by
	looking at numFreeOOPs, not firstFreeOOP.

2000-07-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/gst.y: add `oval' to the union, and define (and parse)
	SCALED_DECIMAL_LITERAL 
	* libgst/lex.c: parse ScaledDecimal literals
	* libgst/sym.c: declared asScaledDecimalSymbol
	* libgst/sym.h: defined asScaledDecimalSymbol
	* libgst/tree.c: defined makeOOPConstant
	* libgst/tree.h: declared makeOOPConstant

2000-07-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: don't overwrite the method cache until we
	are sure that the receiver understands the message (lookupMethod)
	* libgst/lib.c: load AnsiDates.st and ScaledDec.st too
	* libgst/prims.inl: handle case where the receiver is a `Float'
	but the argument is a `SmallInteger' directly in the 41-to-50
	primitives.
	* libgst/xlat.c: another fix to the strength-reduced division
	algorithm.  If adjust is true, fixing the dividend if the signs
	mismatch produces an incorrect result.

2000-06-26  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: restored divide-by-zero check in //, \\ and
	/ (removed by mistake June 21st)

	* libgst/xlat.c: removed interrupt check from the method prolog,
	moved it to the `return' bytecodes and to after a primitive;
	this fixed processes.
	Also INLINED_CONDITIONAL now adjusts the stack top in V2 and then
	resets spDelta instead of simply decrementing spDelta: this
	caused incorrect compilation of #ifTrue:ifFalse: if the receiver
	was inlined and the returned value was used as a parameter to a
	message.  There are no regressions with respect to the bytecode
	interpreter now.

2000-06-21  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: when compiling a #repeat loop, add a dummy
	`push nil' bytecode at the end to please the JIT compiler
	(which said its stack had underflowed -- it was right, but it
	was compiling unreachable code...).
	* libgst/interp.h: made the primitiveTable `const'
	* libgst/interp-bc.inl: use primitives for //, \\ and / if both
	arguments are integers
	* libgst/interp-jit.inl: first fixes to add processes to the JIT
	compiler
	* libgst/prims.inl: fixed meaning of // and \\ for negative divisors;
	in primitive 90, use getReturnIP (defined in interp-jit.inl).
	* libgst/xlat.c: fixed meaning of // and \\ for negative divisors;
	fixed overflow detection in multiplication; align interrupt checks
	to 4 bytes.

2000-06-18  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/dict.c: added to SortedCollection two instance variables
	needed to be able to amortize sorting cost (through heaps & merging).

2000-06-17  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: fixed doesNotUnderstand

2000-06-17  Paolo Bonzini  (bonzini@gnu.org)

	*** Released versions 1.95 (development) and 1.7.5 (stable)

2000-06-10  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/byte.c: fixed bug in optimizeByteCodes (|| was there
	instead of &&) which upset the JIT compiler
	* libgst/comp.c: if a method is a primitive return of a
	BlockClosure, initialize the BlockClosure in methodNew.

	* libgst/oop.c: call releaseNativeCode instead of
	freeNativeCode in prepareForSweep, at the end call
	freeNativeCode
	* libgst/xlat.c: removed definition of MethodEntry, renamed
	freeNativeCode to releaseNativeCode, added freeNativeCode
	* libgst/xlat.h: added definition of MethodEntry, declared
	releaseNativeCode
	* libgst/interp.h: declare validateMethodCacheEntries
	* libgst/interp-bc.inl: added validateMethodCacheEntries (no-op)
	* libgst/interp-jit.inl: added validateMethodCacheEntries

2000-06-07  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/interp.c: fixed behavior of emptyContextStack with
	regard to the returnIP field.
	* libgst/interp-jit.inl: don't look at the header flag in
	sendMessageInternal.
	* libgst/xlat.c: added inlining of arithmetic operations.
	declared TREE_ALT_PUSH and implemented the gen_alt* functions.
	Still missing: processes, doesNotUnderstand:

2000-06-06  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/prims.inl: use a huge table of functions instead of
	a huge switch statement
	* libgst/interp.h: declare table of functions for
	the primitives
	* libgst/internal.h: removed PTR_EXEC_PRIM_OP
	* libgst/interp-jit.inl: same as above.
	* libgst/interp-bc.inl: use primitiveTable instead of
	executePrimitiveOperation
	* libgst/xlat.c: same as above.

2000-06-04  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/byte.c: new function computeStackPositions.
	* libgst/byte.h: declared computeStackPositions.
	* libgst/xlat.c: don't call prepareContext in the prologs
	if the method has no arguments and no temporaries.  Plus,
	use computeStackPositions.

2000-06-03  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: support #valueWithArguments: and other
	primitives (other than 81) which use sendBlockValue.  Wrote
	the code for compiling deferred sends.  Working inlined
	comparisons.

	* libgst/prims.inl: added primitive 90 to retrieve the
	native code for a method.

2000-06-02  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: if USE_JIT_TRANSLATION is defined,
	executeStatements skips some values which aren't mantained in
	that case.

	* libgst/xlat.c: fixed error in pushing thisContext (wrong
	register used, R1 instead of V1).  Fixed problems when the
	stack was empty in setTopNodeExtra.  The method hash table
	was broken -- did not initialize current->receiverClass.
	Also check in the block's prolog, if code for the right
	CompiledBlock is being executed.

	* libgst/interp-jit.inl: reset the exceptFlag after execution
	of JIT-compiled native code is interrupted.  The interpreter
	is now able to create an image and then restore it.

2000-06-01  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/callin.c: support losing systems which don't allow
	va_arg(..., char)
	* libgst/dld_beos.c: new file.

2000-05-29  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/xlat.c: added some inlining (==, isNil, notNil,
	blockCopy:); modified suboperation codes so that `2' is reserved
	to literals (which aids a lot when inlining).  Blocks done, they
	were easy.

2000-05-28  Paolo Bonzini  (bonzini@gnu.org)

	* libgst/comp.c: Moved here a ChangeLog comment that actually
	described the code; gave a category to Behavior>>#methodsFor:

	* libgst/xlat.c: Usual tons of fixes.  Crashes at initialize.st.
	Among others:
	- save the returnIP in the parent context, not in the newly created
	  context (that is before activateNewContext rather than afterwards).
	- fixed the method prolog to update the `self' variable, which I had
	  forgotten
	- labels did not work (had missed a *)
	- do EXPORT_SP_CODE in crucial points, including basic block boundaries

	* libgst/interp.c: new procedure showStackContents
	* libgst/interp.h: declared showStackContents
	* libgst/prims.inl: use showStackContents in the temporary definition
	of #error: and #doesNotUnderstand: (useful for debugging)

2000-05-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/xlat.c: more tons of fixes.  Crashes at Character.st
	* lib/xlat.h: export returnFromNativeCode
	* lib/heap.c: switched to Doug Lea's malloc (only an hour's effort!)
	* lib/interp.c: fixed behavior of `execution environment' contexts
	with the JIT compiler.

2000-05-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib-src/alloc.c: don't exit on malloc(0)
	* lib/xlat.c: tons of fixes; renamed from lib/dynamic.c

2000-05-17  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added a couple of flags (F_XLAT_2NDCHANCE and
	F_XLAT_REACHABLE) for dealing with the changes to lib/oop.c.
	* lib/interp-jit.inl: removed unwindContext and changeProcessContext,
	added getContextIP & setThisMethod
	* lib/interp-bc.inl: moved unwindContext and changeProcessContext
	back to interp.c, added getContextIP
	* lib/interp.c: restored unwindContext and changeProcessContext from
	interp-bc.inl, used getContextIP instead of toInt(...->ipOffset)
	* lib/oop.c: implemented a `second chance' algorithm for disposing
	of methods whose native code translations are not referenced by any
	context.

2000-05-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: moved to lib-src
	* lib/alloc.h: moved to lib-src
	* lib/alloca.c: moved to lib-src
	* lib/getdtablesize.c: moved to lib-src
	* lib/getpagesize.c: moved to lib-src
	* lib/memmove.c: moved to lib-src
	* lib/obstack.c: moved to lib-src
	* lib/obstack.h: moved to lib-src
	* lib/putenv.c: moved to lib-src
	* lib/qsort.c: moved to lib-src
	* lib/strdup.c: moved to lib-src
	* lib/strerror.c: moved to lib-src
	* lib/strtoul: moved to lib-src
	* lib/usleep.c: moved to lib-src
	* lib/waitpid.c: moved to lib-src

2000-05-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/heap.c: derive baseaddr by trying to mmap a page, rather than
	blindly getting sbrk(0)

2000-05-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: abort compilation if a method turns out to be too
	complex for the bytecode set (i.e. if it jumps too far).
	* lib/putenv.c: strdup the added string

2000-05-04  *X*X* (aldomel@ix.netcom.com)

        * lib/sym.h: added #include gst.h
        * lib/lib.c: better error message when the Kernel files can't be
        found (image bootstrap failed).

2000-05-04  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.94.90 released

2000-05-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.y: fixed errors in parsing #( () ) and #[]; the
	former was parsed to (Array with: nil), the last crashed (!)
	* lib/getpagesize.c: created from part of sysdep.c
	* lib/getdtablesize.c: created from part of sysdep.c
	* lib/usleep.c: created from part of sysdep.c
	* lib/sysdep.c: added code to set the `LANG' environment
	variable under Win32.

2000-04-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/register.h: issue the #warning only if using GCC

Wed Apr 26 14:42.52 2000  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.h: relinquish -> usleep, added getpagesize
	* lib/sysdep.c: same as above
	* lib/prims.inl: relinquish -> usleep

2000-04-23  Paolo Bonzini  (bonzini@gnu.org)
 
	* lib/dict.c: changed `length' variable to `size' in FileSegment

2000-04-12  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.7.4 released

2000-04-01  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: completed switch to heaps, using heap_sbrk instead of
	heap_malloc and	heap_realloc.  Removed maxSpaceSize variable.
	* lib/save.c: use memSpace.totalSize instead of maxSpaceSize.

2000-03-31  Hideoki Saito (saito@densan.co.jp)

	* lib/comp.h: fixed bogus error on big-endian machines

2000-03-25  Paolo Bonzini  (bonzini@gnu.org)
 
	* lib/byte.c: added bytecode 134 (for lots of instance variables).
	* lib/byte.h: added bytecode 134.
	* lib/comp.c: added bytecode 134.
	* lib/dynamic.c: added bytecode 134.
	* lib/interp-bc.inl: added bytecode 134.

2000-03-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: removed code for the BSD memory allocator.
	* lib/heap.c: added.
	* lib/heap.h: added.
	* lib/oop.c: use heaps to allow the OOP table to grow.

2000-03-23  Paolo Bonzini  (bonzini@gnu.org)
 
	*** Version 1.7.3 released

2000-03-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added F_XLAT and F_RUNTIME
	* lib/save.c: remove F_RUNTIME flags upon image load

2000-03-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.h: include comp.inl
	* lib/comp.inl: created
	* lib/dict.c: added returnIP to ContextParts
	* lib/dynamic.c: all but blocks is in place...
	* lib/interp.c: moved a few functions to interp-bc.inl
	* lib/interp.h: added returnIP to ContextPart structs
	* lib/interp-bc.inl: (new name of bytecode.inl) moved here a few
	functions that are different for the bytecode and JIT interpreter
	(sendMessageInternal, unwindContext, changeProcessContext, ...)
	* lib/interp-jit.inl: created
	* lib/sym.c: added mustBeBooleanSymbol and badReturnErrorSymbol
	* lib/sym.h: added mustBeBooleanSymbol and badReturnErrorSymbol

2000-03-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: since I added atSignSymbol, I put atSignSpecial here.
	* lib/bytecode.inl: since I added atSignSymbol, I use it instead of
	internString("@").
	* lib/comp.c: since I added atSignSymbol, I generate bytecode 187
	even if it has little use...
	* lib/dynamic.c: shape is getting clearer and clearer...
	* lib/sym.c: added atSignSymbol (for JIT).
	* lib/sym.h: added atSignSymbol (for JIT).

2000-03-11  Paolo Bonzini  (bonzini@gnu.org)
 
	*** Version 1.7.2 released

	* lib/byte.c: isPush -> isPushTable; added isSendTable
	* lib/byte.h: added isPushByteCode & isSendByteCode
	* lib/dynamic.c: began implementing new version
	* lib/dynamic.h: new version

2000-02-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lib.c: use the Undeclared dictionary for files loaded
	from the command line too.
	 
2000-02-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: better output from badType.  Plus, ByteArrays
	passed as Strings are considered null-terminated, and Strings
	passed as ByteArrays are not.
	* lib/interp.c: showBacktrace not static anymore.  Fixed crash
	on sends to super from a block.
	* lib/interp.h: declare showBacktrace.

2000-02-22  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.7.1 released

2000-02-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: added defineCFuncs to test file accessing modes.

2000-02-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/prims.inl: added time-zone primitives for Time
	* lib/sysdep.c: added currentTimeZoneName
	* lib/sysdep.h: added currentTimeZoneName

2000-02-17  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: fixed crash on blocks returning from non-existent
	method contexts; fixed bug in detecting overflows on bit shifts.
	* lib/prims.inl: fixed bug in detecting overflows on bit shifts.

2000-02-15  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.7 released

2000-02-06  Thorsten Klein  (TK@Thorsten-Klein.de)

	* lib/dld_gst.c: missing asterisk in `i' for loop (second
	expression was `i', now is `*i').  Caused SIGSEGV when a missing
	library name was passed.

2000-02-01  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: subsumed bytecodes 132 and 134 (a whole byte for
	the argument count is way too much, and it does not matter if
	it's a bit slower because these bytecodes are rare indeed).
	* lib/byte.c: print bytecode 132 according to the new coding
	* lib/bytecode.inl: interpret new coding for bytecode 132
	* lib/comp.c: emit new coding for bytecode 132

2000-01-31  Paolo Bonzini  (bonzini@gnu.org)

	*** Sixth beta of 1.7 (labeled 1.6.85) released

2000-01-31  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: worked out bugs in call-ins that were added
	after the introduction of the `terminate interpreter' bytecode
	(Jan 8th) and which prevented Blox from working.
	prepareExecutionEnvironment was stacking a context with an OOP
	from the main OOP table over some lifoContexts.
	* lib/oop.c: moved debug() to sysdep.c
	* lib/oop.h: moved debug() to sysdep.h
	* lib/sysdep.c: moved debug() here from oop.c
	* lib/sysdep.h: moved debug() here from oop.h

2000-01-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: fixed bug with double-freeing of block bytecodes
	(this is also due to a very permissive allocator)
	* lib/lex.c: fixed bug in parsePrimitive (xfree without matching
	xmalloc) -- strangely enough, it didn't show up on all systems!
	* lib/prims.inl: fixed Memory primitives to return and accept
	LargeIntegers for addresses when needed.

2000-01-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: changed the clean block detection machinery to work
	with CompiledBlocks.  Previously, we emitted a fixed sequence of
	bytecodes for blocks, then we made a pass on the bytecodes before
	optimization patching already generated code in case we found the
	block to be clean.  Now, instead, we compute information on the
	block's cleanness before we create the CompiledBlock object, we
	embed the information in the CompiledBlock's header, and then use
	that information to directly emit optimized bytecodes in case the
	block is clean (instead of applying patches later).
	* lib/comp.c: moved `class' and `selector' fields to MethodInfo.
	Blocks are compiled to CompiledBlocks.
	* lib/comp.h: removed `class' and `selector' fields from [Compiled]Method
	* lib/dict.c: new definitions of MethodInfo, CompiledCode, CompiledMethod,
	CompiledBlock; declaration of compiledCodeClass and compiledBlockClass.
	* lib/dict.h: declaration of compiledCodeClass and compiledBlockClass
	* lib/interp.c: execute blocks from CompiledBlocks.
	* lib/lib.c: load CompildCode.st and CompiledBlk.st
	* lib/prims.inl: added primitive 68 to create CompiledBlocks.

2000-01-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: fixed crash on methods whose last act was
	returning a clean block.  It turned out that evaluating those
	blocks was GST's last act, either...
	* lib/cint.c: enable passing 32-bit LargeIntegers in C call-
	outs.  Looks like I had forgotten about it on Sep 10 1999.
	Also, introduced a `pVoidFunc' typedef to avoid Lisp-like
	abundance of parentheses when passing C function addresses.

2000-01-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: integerClass -> smallIntegerClass
	* lib/dict.c: integerClass -> smallIntegerClass, plus
	added definition of SmallInteger
	* lib/dict.h: added declaration of SmallInteger
	* lib/gst.h: integerClass -> smallIntegerClass
	* lib/interp.c: integerClass -> smallIntegerClass
	* lib/interp.inl: integerClass -> smallIntegerClass
	* lib/lib.c: load SmallInt.st too.
	* lib/prims.inl: integerClass -> smallIntegerClass

2000-01-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: adapted large integer compilation stuff in
	makeConstantOOP to compile ByteArrays too.
	* lib/gst.y: added rules for ByteArray literals and arrays
	like #(1 2 3 #(4 5 6)) -- i.e. with the sharp inside the
	parentheses
	* lib/lex.c: make parseNumber return BYTE_LITERAL for
	integers between 0 and 255
	* lib/tree.c: added makeByteArrayConstant

2000-01-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lex.c: curStrBuf -> obstack_curStrBuf; plus, added
	the compilationObstack variable which is initialized in
	parseStream.
	* lib/lex.h: added declaration of compilationObstack
	* lib/str.c: added obstack_curStrBuf
	* lib/str.h: declared obstack_curStrBuf
	* lib/tree.c: heavily simplified destruction code by using
	obstacks

	* lib/lib.c: solved SIGSEGV when gst.im was not in the
	current directory and SMALLTALK_IMAGE was not set.

2000-01-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: added code to create Smalltalk LargeInteger
	objects from large integer ConstNodes in makeConstantOOP.
	* lib/gst.y: handle large integer literals in the grammar
	* lib/lex.c: added code to parse large integer literals
	* lib/tree.c: added code to create large integer ConstNodes
	* lib/tree.h: added declaration of the LargeInteger struct
	and of large integer ConstNodes

2000-01-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: added `exitInterpreter' bytecode.
	* lib/comp.h: declared `getTerminationMethod'.
	* lib/comp.c: implemented `getTerminationMethod', and added code
	to installInitialMethods which installs a termination method
	which executes the new bytecode above.
	* lib/bytecode.inl: implemented `exitInterpreter' bytecode.
	* lib/interp.c: contexts created by prepareExecutionEnvironment
	no longer have to be special cased in unwindLastContext.
	* lib/sym.c: added terminateSymbol.
	* lib/sym.h: added terminateSymbol.

2000-01-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: gst enters the new millennium!!! (yeah, I know it
	actually starts in 2001 but I don't want to wait another year... ;-)
	and it does by getting rid of the free lists for contexts -- it is
	faster to use the memory chunks like a stack.
	Also, I replaced tests for `isNil(thisContextOOP)' with tests for
	`!ip'.
	
	* lib/strerror.c: added.
	* lib/sysdep.c: Win32 implementation of getMilliTime now more precise
	* lib/sysdep.h: added macros for frexp and ldexp where they aren't
	available
	 
1999-12-28  Paolo Bonzini  (bonzini@gnu.org)

	*** Fifth beta of 1.7 (labeled 1.6.84) released

	* lib/byte.c: new functions checkKindOfBlock and patchCleanBlocks.
	* lib/byte.h: declaration of patchCleanBlocks.

1999-12-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: new function fixupBlockClosures.
	* lib/comp.c: new way of compiling blocks.
	* lib/bytecode.inl: bytecode 200 is now #blockCopy: (same as the Blue
	Book, but the primitive is implemented differently of course).
	* lib/prims.inl: new implementation of primitive 80 (blockCopy)
	* lib/sym.c: removed #blockCopy:temporaries: (replaced with #blockCopy:),
	added machinery to reveal `clean' blocks
	* lib/sym.h: removed #blockCopy:temporaries: (replaced with #blockCopy:)

1999-12-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: added method to BlockClosure, changed to new
	context structure (methodClass/selector retrieved from the
	compiledMethod, method only there for MethodContexts)
	* lib/interp.c: changed to new context and BlockClosure structure
	* lib/prims.inl: changed to new BlockClosure structure

1999-12-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: store the class and selector in the created
	CompiledMethods.  A first step towards leaner context objects
	(i.e. more speed when sending messages!) and more powerful
	constructs such as `clean' block closures (which do not need
	to be created at run-time because are isolated from the outer
	contexts).
	* lib/comp.h: added `class' and `selector' to struct Method.
	* lib/dict.c: added `class' and `selector' to CompiledMethod.
	* lib/prims.inl: pass class and selector to makeNewMethod.

1999-12-19  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: removed hasBlock (can be replaced with a
	test on whether the context lies in the main OOP table); this
	simplified both sends and returns.  I also made the structure
	of method and block context objects more similar, resulting
	in simpler and faster code (except for block returns), and
	opening doors to optimizations such as delayed filling of the
	`method' and `receiver' slots of context objects.  The overall 
	improvement obtained since the Dec 17 change amounts to 9-10%.
	* lib/dict.c: same as above
	* lib/interp.c: same as above
	* lib/interp.h: same as above
	* lib/prims.inl: same as above

1999-12-17  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: various changes, notably to getMethodContext and
	its users, to avoid using oopToObj more than once on the same
	object.

1999-12-17  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: nil is now 0L (used to be 0), which is better when
	used as a pointer.
	* lib/interp.c: as long as we're sure that the execution order is
	LIFO (i.e. as long as no blocks are involved), allocate OOPs for
	the contexts outside of the main OOP table; this is because
	allocOOP is slower than picking a pre-built OOP out of a stack.
	This partly resembles the design of 1.1.5 (introduced Jan 1, 1991
	and modified Oct 18, 1998), but has the advantage that when a
	BlockClosure is created we only have to allocate the OOPs that we
	tried to avoid -- 1.1.5 copied the whole objects to the main heap,
	causing way too many GCs.

1999-12-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: F_FAKE --> F_POOLED, isFake --> isPooled
	* lib/interp.h: resetFakeContexts --> emptyContextsPool
	* lib/interp.c: (de)allocFakeContext --> (de)allocPoolContext,
	fakeList --> contextPool, plus changes above
	* lib/oop.c: realizeOOPs --> sweepPooledObjects, plus changes above

1999-12-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sym.c: modified hashString to reduce likeliness that
	hash be zero.

1999-12-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: use the new procedures below
	* lib/comp.c: allocated one more bit for the method flags.  If
	there is a primitive index, the flags are now 4 (used to be 0).
	* lib/interp.c: the old `returnWithValue' procedure was split in
	two, unwindToContext and unwindLastContext -- one is used upon an
	explicit `return from method', the other does less job and returns
	to the parent context upon a `return from context'

1999-12-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: moved findClassMethod here from lib/dict.inl
	* lib/dict.h: restored declaration of findClassMethod
	* lib/dict.inl: moved findClassMethod here to lib/dict.c -- it is
	used rarely (only for method cache misses) and was bloating
	sendMessageInternal's code.

	* lib/bytecode.inl: simple one-byte bytecodes prefetch the next
	address to jump to (hoping to save address generation interlocks)
	* lib/interp.c: support for prefetching

1999-12-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: hard-code register allocation of ivar2
	and tempOOP only where they are actually used
	* lib/dict.inl: hard-coded register allocation in nilFill
	* lib/interp.c: hard-coded register allocation now relies on
	register.h and is used in sendMessageInternal/sendBlockValue.
	* lib/register.h: created

1999-12-05  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: returnMethodStackTop became returnContextStackTop
	in isSimpleReturn.
	* lib/cint.c: declare the strerror C function.
	* lib/gst.h: ANSI asks for 65535 instance variables, so I shifted
	the instance specification's `number of instance vars' field
	right by three bits (now 262143 variables are possible).
	* lib/lex.c: parse stuff like 1.0d53 and 1.0q212 correctly even
	though FloatD/FloatE/FloatQ is not supported yet.

	* lib/memzero.h: removed a conditional by using LONG_SHIFT in the
	generic version of memzero.

1999-12-05  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: the `hasBlock' instance variable in a context
	is now an integer (0 or 1).  This eliminated several lookups for
	the `trueOOP' and `falseOOP' globals.
	* lib/interp.c: same as above
	* lib/prims.inl: same as above

1999-11-26  Paolo Bonzini  (bonzini@gnu.org)

	*** Fourth beta of 1.7 (labeled 1.6.83) released

	* lib/bytecode.inl: added caching of primitive numbers for sends of
	#at:, #at:put: and #size
	* lib/interp.c: same as above
	* lib/prims.inl: same as above

1999-11-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: fixed floating-point exception on operations
	with infinity and NaN, under FreeBSD.

1999-11-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: use memzero instead of memset; also, xmalloc
	doesn't zero memory
	* lib/byte.c: use memzero instead of memset
	* lib/dict.inl: use memzero instead of memset
	* lib/dynamic.c: use memzero instead of memset
	* lib/gst.h: include memzero.h
	* lib/memzero.h: added

	* lib/oop.c: don't update numFreeOOPs on allocate/free oop.
	It is only used after a GC (to check whether the OOP table
	must be resized), so it is sufficient that it be correct
	after a GC.

1999-11-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: restoreCFuncDescriptor was called at the wrong
	time in save.c -- before the xxxClass variables were loaded
	(Oct 20 change).  So now it is called here.
	* lib/save.c: see above for lib/dict.c

1999-11-20  P. Lecoanet

	* lib/bytecode.inl: special case #blockCopy:temporaries: for
	context objects and #value/#value: for BlockClosure objects.
	Also, no need to push and pop the object for the `return
	self/true/false/nil' bytecodes -- a simple assignment will do.

1999-11-19  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: removed initNilVec and nilVec
	* lib/dict.inl: implemented nilFill as an unrolled loop (memcpy
	is sloooow)
	* lib/interp.c: arguments are moved between contexts with an
	unrolled loop (memcpy is sloooow); pushNNils now sets up the
	whole context stack (arguments+temporaries) and is called
	prepareContext.  Another +10% for this on send-heavy benchmark!!!

1999-11-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: returnBlockStackTop became returnContextStackTop
	* lib/comp.c: compile returns from methods as returnContextStackTop
	(should be a bit faster)
	* lib/bytecode.inl: `return self' and other similar bytecodes
	fall into returnContextStackTop, not returnMethodStackTop.

1999-11-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: changed to account for removal of cacheHits and
	messagesSent.
	* lib/comp.h: removed messagesSent.
	* lib/interp.c: removed cacheHits and messagesSent, which 
	can be deducted from other statistics.
	* lib/interp.h: removed cacheHits.
	* lib/prims.inl: new implementation of mutation does not need
	primitive 263 (#specialBasicAt:).

1999-11-17  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.inl: access functions test subscript bounds -- this
	eliminates an instanceSpec lookup.
	* lib/prims.inl: no need to call checkIndexableBoundsOf on
	access primitives (#at:*, #basicAt:*)
	* lib/gst.y: Support for the #(1 2 3 #a #b #'cdef' 45) syntax
					     ^^ ^^ ^^^^^^^

1999-11-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: `return instance variable' stores index in the
	`primitive' field of the method header (allows more optimizations
	and better register allocation in sendMessageInternal)
	* lib/comp.h: move flag bits to high end of the methodHeader, so
	that there is place for two additional bits if needed
	* lib/dict.c: BlockContexts now hold the receiver and the
	BlockClosure instead of the number of arguments and temporaries.
	* lib/interp.c: same as comp.c and dict.c above; plus, removed
	code for ACCESSOR_DEBUGGING.
	* lib/interp.h: same as dict.c above

1999-11-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: nilVec contains now 128 OOPs
	* lib/dict.inl: nilVec contains now 128 OOPs
	* lib/interp.c: doc fixes; cleaned up unused variables in the code
	handling fake contexts; finally, the method cache now includes
	the method header (+5/10% performance).

1999-11-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dynamic.c: move method whose threaded code representation
	is requested to the head of the methodsTable.
	* lib/lex.c: USE_MONCONTROL only affects the interpreter, not the
	lexer.
	* lib/lib.c: disable execution tracing options when the dynamic
	translator is being used.
	* lib/oop.c: removed code for ACCESSOR_DEBUGGING, which I found
	more bug-prone than useful in more than a year; added lines
	explaining GC_TORTURE.
	* lib/oop.inl: removed the few lines that implemented the
	ACCESSOR_DEBUGGING preprocessor symbol and explained what it was
	for.

1999-11-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: in most bytecodes that are implemented with a
	switch statement, the switch statement is resolved at translation
	time.  Also, added `default' clauses to such switch statements so
	that the compiler can produce better code.
	* lib/dynamic.c: same as above
	* lib/dynamic.h: same as above
	* lib/interp.c: same as above

	* lib/gst.h: removed declarations of TreeNode, thisClass and
	regressionTesting, which are already declared elsewhere
	(respectively in tree.h, comp.h and lib.h).  Also removed
	declaration of Stream which is needed only in lex.c and is
	therefore moved there.
	* lib/lex.c: moved declaration of Stream from gst.h

1999-11-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dynamic.c: invalidating the macro opcode cache is now
	separated from invalidating the threaded code cache. Also,
	convert from threaded code ip to bytecode ip before 
	invalidating the threaded code cache; reload the methodBase 
	and the threaded ip after having invalidated it (in
	invalidateMethodCache). Everything works if no optimization 
	options are set when compiling.

1999-11-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/callin.c: selectorNumArgs used; in addition, the result
	is checked to be the `nil' object in msgSendf is checked and,
	if so, 0 (or some variation of it, like 0.0 and NULL) is
	returned.
	* lib/interp.c: added DEBUG_CODE_FLOW preprocessor symbol that
	prints every message that is sent in the same form used by
	backtraces (e.g. `Integer(Object)>>#retry:coercing:').
	* lib/prims.inl: selectorNumArgs used in implementation
	of #perform:...
	* lib/sym.c: added selectorNumArgs
	* lib/sym.h: added selectorNumArgs

1999-11-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: fixed bug in makeDestinationTable that caused
	macro-opcode inlining to lose as soon as a jump was found.
	* lib/dynamic.c: had mistyped an = for an == grrr... 2 days to
	find it! Now runs up to WeakObjects.st both with and without
	macro-opcode inlining, so macro opcodes should be reasonably
	bug-free (except for problems arising from inlining code
	optimized by GCC, which I have not tackled yet).

1999-11-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: jump bytecodes must be `PROTECT' bytecodes,
	isNil and notNil sends need not.  Found two unused variables.
	* lib/cint.c: moved `extern' declaration of enableGC into cint.h,
	the actual declaration of the variable came here from interp.c
	* lib/cint.h: moved `extern' declaration of enableGC from cint.c
	* lib/interp.c: moved getMethodLiterals to interp.inl and
	enableGC to cint.c
	* lib/interp.inl: moved getMethodLiterals from interp.c

1999-11-05  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: can print bytecodes without a vector of literals
	* lib/dynamic.c: added debugging support; offsetToFill was not reset
	when a non-inlinable opcode was found (fixed by setting it in
	newOpcodeEntry) -- now runs up to the first jump bytecode
	(#initialize in Character.st), or up to MethodDict.st
	with macro-opcode inlining disabled.

1999-11-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dynamic.c: work on the dynamic translator restarted. The first
	correct dynamically code was generated today: a small step for
	humanity, a big step for me (hmmm... maybe it was the other way
	round...) -- runs up to the first `inlined opcode-non inlined opcode-
	inlined opcode' pattern (line 1358 of Builtins.st)
	* lib/interp.c: work on the dynamic translator restarted

1999-10-31  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: fixed bug when compiling an integer constant
	that did not fit in the first 31 literals (`push instance
	variable[x]' was emitted instead of `push literal[x]')

1999-10-31  Paolo Bonzini  (bonzini@gnu.org)

	*** Third beta of 1.7 (labeled 1.6.82) released

1999-10-30  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: a few bytecodes were still sending #booleanRequired
	instead of #mustBeBoolean (see May 3rd change).

1999-10-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/save.c: ensure that upon load the heap is at least 50% free.

1999-10-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: added characterArrayClass
	* lib/dict.h: added characterArrayClass
	* lib/lib.c: added CharArray.st

1999-10-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: the new startup sequence (Oct 9) allowed to
	make the dictInit function (now called initNilVec) static.
	So that has been done since dictInit was just a hack:
	it initialized variables in dict.c like initDictionary,
	but while the latter is called from lib.c, dictInit had to
	be called from initOOPTable and loadFromFile).
	* lib/dict.h: removed declaration of dictInit.
	* lib/oop.c: removed call to dictInit.

1999-10-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dld_hpux.c: `return 0' was missing in gst_dld_init
	* lib/lib.c: put the image in the local directory if the
	image directory is missing or not writeable.
	* lib/sysdep.c: added fileIsWriteable, plus usage of time_t;
	strdup was erroneously declared in getFullFileName.

1999-10-11  Paolo Bonzini  (bonzini@gnu.org)
	
	* lib/comp.c: removed addForcedSelector (a copy of addForcedObject).
	Open coding of #whileTrue, #whileFalse, #repeat; removed open
	coding of #yourself.
	* lib/dict.c: restored lookupKeyClass and its definition as I
	finally understood what it was meant to do; modified Association's
	definition (doesn't include key instance variable anymore).
	* lib/dict.h: same as above

1999-10-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: added reallocOOPTable.
	* lib/oop.inl: call reallocOOPTable instead of exiting when
	ran out of OOP table slots.
	* lib/save.c: fixupObject, restoreObject, restoreInstanceVars accept
	an mst_Object instead of an OOP; more coherent with their names and
	a bit more efficient too.  Also moved updating of CFunctionDescriptors
	from restoreInstanceVars to fixupOOPInstanceVars (it is not needed
	when saving, only when loading, and was the only part of the code
	that required the parameters to be OOPs).
	* lib/save.h: fixupObject and restoreObject are now public.

1999-10-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: define the `min' and `max' macros.
	* lib/lib.c: used oopTableSize instead of OOP_TABLE_SIZE;
	use additional parameter to initOOPTable.
	* lib/oop.c: added to initOOPTable a parameter to specify the
	table size; defined oopTableSize and used instead of
	OOP_TABLE_SIZE.
	* lib/oop.h: OOP_TABLE_SIZE became INITIAL_OOP_TABLE_SIZE;
	declared oopTableSize.
	* lib/oop.inl: used oopTableSize instead of OOP_TABLE_SIZE
	* lib/prims.inl: used oopTableSize instead of OOP_TABLE_SIZE
	* lib/save.c: used oopTableSize instead of OOP_TABLE_SIZE;
	use additional parameter to initOOPTable.

1999-10-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: moved builtin objects at the front of the oop table;
	this is a first step towards a variable-sized oop table
	(believe it or not, I did it in less than half an hour!!).
	* lib/oop.h: same as above.
	* lib/oop.inl: same as above.
	* lib/prims.inl: same as above.
	* lib/save.c: same as above.
	* lib/sym.c: same as above.

1999-10-09  Paolo Bonzini  (bonzini@gnu.org)

	*** Second beta of 1.7 (labeled 1.6.81) released

	* lib/bytecode.inl: added a few experimental branch labels
	for the dynamic translator.
	* lib/prims.inl: added primitive 90 to flush the dynamic
	translator's code cache.

	* lib/dict.c: added code to reinitialize the global OOPs (which
	are not saved anymore so that the image is more compatible). Also,
	the OOP indices associated to Smalltalk, Processor and the
	SymbolTable are fixed so that we know them without storing them
	in the image file. Finally, declare the `Undeclared' dictionary in
	initSmalltalkDictionary().
	* lib/oop.c: removed markGlobalOOPs (instead, just mark the
	`Smalltalk' dictionary).
	* lib/save.c: removed the global OOPs; they are reinitialized
	every time in dict.c.
	* lib/save.h: removed the global OOPs
	* lib/sym.c: added undeclaredSymbol, and used in findClassVariable.
	* lib/sym.h: added undeclaredSymbol.

1999-10-07  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: restored old MethodDictionary class (see
	March 29th, 1989 entry!) It was needed after all.
	* lib/dict.h: same as above
	* lib/lib.c: same as above
	* lib/save.c: same as above
	* lib/sysdep.c: fixed faked closePipe to return status of child
	process.

1999-10-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: was trimming the last character of the method's
	source code in FileSegments.
	* lib/lex.c: was trimming the last character of the method's
	source code when creating Strings from source code read from
	a file.
	* lib/lib.c: added -K option, don't crash on -I/-L/-K without
	mandatory argument.

1999-09-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: initProcessSystem removed the initial process from
	its own process list -- result: as soon as `Processor yield' was
	called, highestPriorityProcess did not know that the active process
	was active!
	* lib/prims.inl: relinquish control to other processes on #yield.
	* lib/lib.c: `gst -a' caused a segmentation violation
	* lib/sysdep.h: declaration of `relinquish'.
	* lib/sysdep.c: implemented `relinquish'.

1999-09-25  Paolo Bonzini  (bonzini@gnu.org)

	*** First beta of 1.7 (labeled 1.6.80) released

	* lib/bytecode.inl: use areInts in open-coded operators.
	* lib/gst.h: added areInts, removed F_FINALIZING.
	* lib/oop.c: store objects to be finalized in a buffer, to avoid
	an OOP table scan.
	* lib/str.h: added declaration of generic buffer functions
	* lib/str.c: added generic buffer functions (not limited to chars)
	* lib/dld_aix.c: added
	* lib/waitpid.c: added
	* lib/strtoul.c: added

1999-09-23  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dynamic.c: created.
	* lib/dynamic.h: created.
	* lib/obstack.c: added, fixed to use _obstack_memcpy.
	* lib/obstack.h: added.
	* lib/sysdep.h: added flushCode.
	* lib/sysdep.c: added flushCode & signalAfter implementation using
	fork()+getMilliTime().

1999-09-19  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: declare lookupTableClass
	* lib/dict.h: declare lookupTableClass
	* lib/lib.c: load LookupTbl.st and WeakObjects.st

1999-09-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.y: include "lib.h", define YYPRINT
	* lib/lex.c: define yyprint
	* lib/lex.h: declare yyprint
	* lib/lib.h: added declaration of "quietExecution", previously only
	in lib.c

1999-09-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: added mkdir declaration.

1999-09-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Added DefaultSortBlock to SortedCollection.
	* lib/lex.c: fixed bug; 8-bit characters *outside* string literals
	crashed the lexer.
	* lib/sysdep.c: use getcwd if HAVE_GETCWD (new symbol) is set and
	getwd otherwise.  Old behavior was to use getcwd if HAVE_UNISTD_H
	was set and getwd if HAVE_GETWD was set

1999-09-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: compile doits in UndefinedObject.

1999-09-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: moved variables from ClassDescription; instanceVariables to
	Behavior; name/comment/category/environment to Class (they make no sense
	in Metaclass!).
	* lib/dict.h: same as above.

1999-09-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: changes for namespaces (execute doits in the current namespace).
	* lib/dict.c: same as above (shared pool variable search algorithm,
	new `environment' variable, declaration of currentNamespace).
	* lib/dict.h: same as above (added `environment' variable to ClassDescription,
	declaration of currentNamespace).
	* lib/dict.inl: same as above (setClassEnvironment).
	* lib/prims.c: same as above (primitive 250 to tell the compiler about the
	current namespace).
	* lib/save.c: same as above (added uppercaseSuperSymbol, currentNamespace).
	* lib/sym.c: same as above (shared pool variable search algorithm).
	* lib/sym.h: same as above (added uppercaseSuperSymbol).

1999-09-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: variableWordSubclasses use accessors for 32-bit integers.
	BlockClosures are now variableWordSubclasses since the previous encoding
	was incompatible with the code to switch the endianness in a saved image.
	* lib/dict.inl: added accessors for 32-bit integers (64-bit on Alphas).
	* lib/gst.h: added warning that says Alphas are not ok yet.
	* lib/gst.y: shell was unusable after a parse error -- solved.
	* lib/interp.h: New encoding of BlockClosures (see above).
	* lib/prims.inl: C object and memory address primitives use the above
	accessors.

1999-09-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/prims.inl: flush the FileStream before reading its size.

1999-09-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: added idleTasks variable to ProcessorScheduler.
	* lib/interp.h: added idleTasks variable to ProcessorScheduler.
	* lib/lib.c: allowed -- to stop option parsing, to comply with getopt.
	* lib/sysdep.c: added POSIX interrupt handling (sigprocmask); Win32
	code for alarms now uses kill(2) instead of manually calling the
	handler.

1999-09-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.y: added support for [ :a :b || temp1 temp2 | ].
	* lib/lex.c: unreadChar not static anymore.  Also removed scanStringoid
	and moved its code to stringLiteral.  Parsing a comment does not
	actually require to store the whole comment in memory, so it is a
	conceptually different operation.  Fixed for the change to str.c below.
	Removed memory leak in printToken (not so important since it's just
	debugging code, but it's a bug).
	* lib/lex.h: unreadChar is now extern.
	* lib/lib.c: removed references to resizeString.
	* lib/str.c: removed resizeString, curStrBuf now returns a copy of the
	string (previously it was a chore left to its caller through strdup).

1999-08-31  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: registers where the interpreter's ip and sp stay are
	hard-coded for most architectures.  Added definitions for the high
	speed interpreter with dynamic translation.
	* lib/interp.inl: moved internal accessors to interp.c; moved object
	equality and hashing functions to dict.inl (the only places where they
	were actually used).

1999-08-30  Paolo Bonzini  (bonzini@gnu.org)

	* lib/bytecode.inl: created from part of interp.c
	* lib/gst.h: removed `extern' definition of the instruction pointer.
	* lib/interp.c: made the instruction pointer static; prepared for the
	new bytecode.inl file; relativeByteIndex is replaced by
	currentBytecodeIndex; added definitions of the latter macro.
	* lib/interp.inl: removed relativeByteIndex.
	* lib/prims.inl: relativeByteIndex is replaced by currentBytecodeIndex.

1999-08-29  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.6.2 released.

1999-08-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: always define DLD functions (at worst they're stubs)
	* lib/dld_none.c: created.
	* lib/lib.c: always load DLD.st (at worst it refers to C stubs)

1999-08-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: put CDoubleMin and CDoubleMax in the Smalltalk dictionary.
	* lib/interp.c: NEXT_BYTECODE was not defined for old (switch statement)
	dispatching.

1999-08-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: in initRuntimeObjects, define the ImageFileName global
	as equal to binaryImageName.
	* lib/lib.c: load .stpre only when creating local image files.  Removed
	findImageFile.  Option -v shows the hard-coded kernel and image paths.
	binaryImageName is not static anymore, defaultImageName is.
	* lib/lib.h: removed findImageFile.  binaryImageName is now declared
	here as an extern symbol, and defaultImageName is not.
	* lib/prims.inl: `Smalltalk snapshot' primitive (250) removed -- the
	new ImageFileName global makes it redundant.
	* lib/save.c: loadFromFile now expects a full path to the image just like
	saveToFile, does not call findImageFile.

1999-08-07  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: declare `unlink' (valid only for files) instead of `remove'
	(which nukes whole directories too) to be used to implement
	File class>>#primRemove:
	* lib/sysdep.c: added simulation of popen and pclose in openPipe
	and closePipe.

1999-08-07  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.h: initSTDIOObjects became initRuntimeObjects
	* lib/dict.c: initSTDIOObjects became initRuntimeObjects, and various
	initializations (Features, KernelPath, ImagePath) were moved here from
	initSmalltalkDictionary.  This completes the change made on July 14th.
	* lib/lib.c: initSTDIOObjects became initRuntimeObjects

1999-08-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.inl: relativeByteIndex now explicitly casts to int for
	Alpha compatibility.
	* lib/sym.c: switched from int to long when dealing with differences
	between addresses, for Alpha compatibility.
	* lib/dict.c: switched from int to long when dealing with differences
	between addresses, for Alpha compatibility.

1999-07-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dld_gnu.c: added gst_dld_exts (.o, .a)
	* lib/dld_gst.h: added gst_dld_exts
	* lib/dld_gst.c: added gst_dld_openext
	* lib/dld_hpux.c: added gst_dld_exts (.sl)
	* lib/dld_ltdl.c: added gst_dld_exts (dummy)
	* lib/dld_libdl.c: added gst_dld_exts (.so, .a)
	* lib/dld_win32.c: added gst_dld_exts (.dll, .exe)

1999-07-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added F_BYTE, used while saving to ease reloading
	if the endianness changes.
	* lib/save.c: added ability to load images from machines with
	different endianness and to recognize (and reject) images from
	machines with different sizeof(long).  This change unveiled a bug
	in GNU C 2.7.2!!!
	* lib/dld_ltdl.c: created (thanks to Alexander Shinn for pointing
	me to libtool!)

1999-07-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: interruptHandler should set again the handler
	for SIGINT
	* lib/sysdep.c: fixed syntax error. Also, sigaction should use
	SA_RESETHAND if available because signal is supposed to work
	that way.
	* lib/sysdep.c: #define SIGALRM if not provided by C headers.

1999-07-05  Paolo Bonzini  (bonzini@gnu.org)

	* gstconf.h.in: Changed USE_READLINE to HAVE_READLINE (more coherent)
	* gstconf.h: same as above
	* lib/comp.c: same as above
	* lib/lex.c: same as above
	* lib/lex.h: same as above
	* lib/lib.c: same as above

1999-07-04  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.c: renamed dprintf to debugf. glibc 2.0 defines
	a different prototype for a function with the same name (glibc 2.1
	only defines it if __USE_GNU is defined and does not break gst).

1999-06-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/qsort.c: added standard stuff to make alloca work.
	* lib/gstpub.h: moved inclusion of gst.h *inside* `extern "C"'

1999-06-25  Paolo Bonzini  (bonzini@gnu.org)

	*** Bug-fixing version 1.6.1 released.

1999-06-21  Paolo Bonzini  (bonzini@gnu.org)

        * lib/alloc.c: in xrealloc, we must call malloc explicitly when
        the first argument is 0, since some reallocs don't do this.
        * lib/cint.c: Fix for Solaris' brokenness (in their stat.h, they use
        `#define st_atime st_atim.tv_sec')
        * lib/qsort.c: added (from GCC).

1999-06-17  Mark Elbrecht  (snowball@bigfoot.com)

	*** Version 1.6 released.
        * lib/lex.c: Fix crash when using drive letters in isKernelFile.
        * lib/lib.c: For DOS, use '_stinit' and '_stpre' as init files since
        DOS doesn't allow a period to start a filename.

1999-06-09  Pahi Andras  (pahi@mozart.eet.bme.hu)

	* lib/cint.c: defineCFunc makes a private copy with strdup of the
	C function's name. The problem is likely to root to the pre-DLD days
	(1989-1990) when only string constants were passed to defineCFunc, so
	strdup was unnecessary.

1999-06-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: added displayCompilationTrace
	* lib/comp.h: added declaration of displayCompilationTrace
	* lib/prims.inl: if declaration tracing is on, shows new
	categories as encountered.

1999-05-30  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added default values for the definitions that used to
	be in gstpaths.h
	* lib/gstpaths.h: removed since configure did not create it properly
	after the installer was fixed
	* lib/Makefile.in: added definitions to be used in place of gstpaths.h
	* lib/lib.c: if the the paths cannot be located, try using the local
	directory
	* lib/lib.h: defaultImageName is now a variable
	* lib/str.c: added resizeString

1999-05-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: object passed as `unknown' or `self', whose class is not
	recognized, are now passed as an OOP (they used to be skipped).
	* lib/interp.c: the open-coded // was rounding like quo: does.
	* lib/prims.inl: the base date for secondClock was 2 Jan 2000 instead
	of 1 Jan 2000.  This was apparent after the fix above.

1999-05-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: moved platform-dependent definitions here.  Modified
	so that, if we replace libc's allocator, we define calloc too (see
	glibc's manual).  Also modified so that xmalloc exits if it fails.
	* lib/alloc.h: removed platform-dependent definitions.  Now this
	file only contains extern declarations (correctly).

1999-05-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added code to #define `volatile' to nothing if it is
	not supported.
	* lib/interp.c: modified to pass through -Wall when optimization
	is on.  This highlighted a possible (although never observed) bug in
	sendMessageInternal: the setjmp/longjmps in executePrimitiveOperation
	could have clobbered methodOOP, which is now declared volatile.

1999-05-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: modified to (almost) pass through -Wall.
	* lib/cint.c: modified to pass through -Wall.
	* lib/comp.c: modified to pass through -Wall.
	* lib/dict.c: modified to pass through -Wall.
	* lib/dict.inl: modified to pass through -Wall.
	* lib/gstpub.h: added C++ `extern "C"' guard.
	* lib/interp.c: modified to pass through -Wall.
	* lib/interp.inl: modified to pass through -Wall.
	* lib/lex.c: modified to pass through -Wall.
	* lib/oop.c: modified to pass through -Wall.
	* lib/save.c: modified to pass through -Wall.
	* lib/sym.c: modified to pass through -Wall.

1999-05-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/callin.c: added objectAlloc.
	* lib/gst.h: added guards to avoid including heavily implementation
	dependent stuff when gst.h is included by gstpub.h
	* lib/gstpub.h: changed to use those guards.
	* lib/dld_hpux.c: created.
	* lib/dld_libdl.c: new name of dld_sun.c
	* lib/lex.c: stream description for readline streams is not
	`a Readline string' anymore, but `stdin' (since that's where we
	actually get the string).  Also, when readline is used I also
	include <readline/history.h> now; and I disable readline's auto-
	completion feature, not supported by gst (initializeReadline).


1999-05-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: various performance counters are now unsigned longs.
	* lib/comp.h: various performance counters are now unsigned longs.
	* lib/interp.c: #mustBeBoolean is now sent to the object that should
	have been a Boolean, as the Blue Book says.  Plus, same as above.
	* lib/interp.h: various performance counters are now unsigned longs.

1999-05-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/id.c: removed -- I'm very sorry to do it, since it was created
	10 1/2 years ago, but it was a copy of str.c
	* lib/id.h: removed -- I'm very sorry to do it, since it was created
	10 1/2 years ago, but it was a copy of str.h
	* lib/lex.c: removed references to function that used to be in poor id.c;
	changed references to copyStr to use strdup.
	* lib/prims.inl: added code to test for infinity, NaNs and other failures
	in mathematical functions (exp/ln/sqrt/trigonometry).
	* lib/str.c: removed copyStr.
	* lib/sysdep.h: added portable macros to test for nan and infinity.
	Not all libc's have isnan, isinfinity and the like.

1999-05-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: fixed bug when compiling to:do:/to:by:do: and the loop
	index temporary was in position 15 (a 2-byte push was erroneously
	compiled, since a 1-byte push can be used).
	* lib/interp.c: did not trap divides by zero on open-coded // messages.
	* lib/lib.c: added Transcript.st to the list of kernel files.
	* lib/oop.c: Character objects' objSize field was uninitialized. Fixed.
	* lib/prims.inl: fixed SIGSEGV on (IndexableClass new: aNegativeNumber).

1999-05-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: added exceptionHandlers variable to Process.
	* lib/gst.y: fixed bug with conditional compilation -- conditional
	exclusion was not disabled by the double bang sequence.
	* lib/interp.h: added exceptionHandlers variable to Process.

1999-05-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: changed the system message #booleanRequired to
	#mustBeBoolean for coherence with the Blue Book (I had not noted
	that passage).  Fixed async signals (actually, I just removed
	the error messages -- they seem to work as they are and their
	implementation is exactly the same as in the book...) and
	changed the signal handling routines to use them instead of
	separate variables.  Added asyncSignal().
	* lib/interp.h: added declarations for asyncSignal().
	* lib/interp.inl: fixed unparenthesized arguments in the `equal' macro.
	* lib/gstpub.h: added declarations for asyncSignal().
	* lib/lib.c: search for a local copy of the kernel files in the
	`kernel' subdirectory of the local directory; always save the
	kernel sources as FileSegments.  This way, GNU Smalltalk works
	both if a) it is installed and the kernel lies in /usr/local/share
	b) it is not installed and everything is done inside the
	user's home directory c) it is not installed, we are under Windows
	and everything is done inside the current directory (maybe I'll
	switch to the executable directory in the future...)

1999-04-29  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: now does compile correctly optimized selectors whose
	block arguments have arguments or temporaries.  In fact I simply
	don't optimize them -- but maybe I will sooner or later.  Also,
	#timesRepeat:, #to:do: and #to:by:do: are now open-coded.
	Finally, I fixed the fact that the bytecodes for an erroneous method
	were put at the beginning of the next syntactically valid method.
	* lib/lib.c: the `Smalltalk Ready' banner is now `GNU Smalltalk Ready'.
	* lib/save.c: added timesRepeatColonSymbol, toColonDoColonSymbol and
	toColonByColonDoColonSymbol.
	* lib/sym.c: same as above.
	* lib/sym.h: same as above.

1999-04-27  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.5.beta3 released.
	* lib/alloc.c: added inclusion of stdlib.h (or malloc.h for old C's)
	when the custom allocator is not used.
	* lib/byte.c: fixed optimization of pushIndexed.
	* lib/dld_sun.c: added missing semicolon.
	* lib/interp.c: finished new GCC implementation at last -- now we
	only have to do a single goto for EVERY bytecode.  Maybe something
	better could be done by caching dispatchVec in a register...  Auto-
	matic #undef-ining of USE_OLD_DISPATCH is now based on the new
	gstconf.h definition HAVE_GOTO_VOID_P (used to simply check __GNUC__).

1999-04-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: added optimization of nopBytecode.  Added `replace
	stack top' bytecodes 140-142 in optimizeBasicBlock.
	* lib/byte.h: added `replace stack top' bytecodes.
	* lib/comp.c: added yourselfSymbol in whichBuiltinSelector (yourself
	is now open-coded).
	* lib/interp.c: added `replace stack top' bytecodes.
	* lib/prims.inl: changed GC-tuning primitives (spaceGrowRate
	and growThreshold) to accept integers too.
	* lib/sym.h: added yourselfSymbol.
	* lib/sym.c: added yourselfSymbol.
	* lib/save.c: added yourselfSymbol.

1999-04-23  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: cleaned up some definitions for ANSI features which
	can be checked by autoconf -- the old #ifdef method only makes things
	cumbersome.  Also renamed config.h to gstconf.h, so that it can be
	installed without filename clashes.
	* lib/interp.c: changed verbose execution tracing to print the stack
	top *BEFORE* the bytecode -- the output is easier to follow.  Added
	jump lookahead (see definition of JUMP_LOOKAHEAD).
	* lib/oop.c: began switching to something resembling a generational
	collector.  Changed GC-tuning variables (spaceGrowRate/growThreshold)
	to be integers -- because they are now checked in allocObj and doubles
	are more expensive in busy code, I think.

1999-04-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: merged bytecodes 138-139 (push/store outer temp) into a
	single bytecode 138, which can also do a `pop and store outer temp'.
	* lib/byte.c: same as above. The new bytecode behaves much like bytecode
	126, so the code for that bytecode in the optimizer can be used by the
	new bytecode too.  Added more cases in the peephole optimizer.
	* lib/comp.c: same as above.
	* lib/interp.c: same as above. Moved various optimization #define's at
	the top of the file.

1999-04-20  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: optimizer in and working.  Fixed challenging cases in
	the flow analyzer which were apparent now because the peephole
	optimizer does some `interesting' changes to the bytecode -- previously
	the changes were not `interesting' enough for these bugs to show up.
	Performance +5-10%, but some interesting optimizations are not there
	yet (e.g. pop-store/push --> store, and push/push --> dup).

1999-04-19  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: added to the flow analysis some support for optimizing
	#ifTrue: and #ifFalse: in the common case where their result is
	discarded.  Added a first peephole optimizer in optimizeBasicBlock.
	* lib/byte.h: added nop bytecode 139
	* lib/comp.c: changed the compilatation of #ifTrue:/#ifFalse: to one
	which is more optimizable if the result is discarded.  #and:/#or: are
	left as they were because their result is usually kept.  Also ALWAYS
	put a pop bytecode at the end of a statement -- it makes flow analysis
	simpler and is removed by the peephole optimizer if unnecessary.
	* lib/interp.c: added nop bytecode 139

1999-04-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: the new optimization scheme proved to be easily
	extendable (which is what I wanted). I added jump optimization
	(10 lines of code) and unreachable code elimination (5 lines) -- no
	big speed improvements, but now I have moer experience with
	optimization and will approach peepholing.
	* lib/byte.c: modified various internal functions to avoid continuous
	reallocation of bytecodes.  For instance, reallocByteCodes uses
	xrealloc() -- it was always malloc-ing everything from scratch --
	and allocByteCodes and reallocByteCodes have a parameter with the
	amount of memory to be allocated.
	* lib/cint.c: call initDldLib if HAVE_DLD is defined.

1999-04-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dld_gst.c: created from old cxtnsn/dld.c
	* lib/dld_gst.h: created
	* lib/dld_gnu.c: created
	* lib/dld_sun.c: created
	* lib/dld_win32.c: created
	* lib/byte.c: changed the algorithm for optimizeByteCodes.  Instead of
	doing a single scan on the bytecodes and fixing up jumps the hard way,
	I'm now dividing the bytecodes into basic blocks, optimizing each of
	them one at a time in optimizeBasicBlock.
	* lib/dict.c: moved hasBlock to ContextPart, yanked it out from
	BlockContext and MethodContext.
	* lib/interp.c: moved hasBlock to the fourth position (inside
	MethodContexts and BlockContexts) so that we can put it in ContextPart.
	* lib/lib.c: load DLD.st from kernel if HAVE_DLD is defined.

1999-04-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.c: functions handling time_t's now use signed longs.
	* lib/sysdep.c: stole more portable implementations of adjustTimeZone
	and currentTimeZoneBias from GNU Emacs.  Added support for broken
	versions of localTime(3) that cache the time zone.
	* lib/sysdep.h: functions handling time_t's now use signed longs.

1999-04-10  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.5.beta2 released.
	* lib/cint.c: my_stat now adjusts file times to local times.
	* lib/sysdep.c: added adjustTimeZone and currentTimeZoneBias.
	* lib/sysdep.h: added adjustTimeZone and currentTimeZoneBias.

1999-04-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: fixed my_stat to return times relative to 1/1/2000
	to avoid possible overflows (which would have happened around 2004
	on 32-bit machine, and around 8.000.000.000 AD on 64-bit ones...).

1999-04-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: fixed bug in sendMessageInternal and sendBlockValue.
	Basically, we now make sure that sp and thisContext->spOffset are
	consistent whenever a GC could happen; otherwise, fixupObjectPointers
	recomputes thisContext->spOffset from sp, storing an erroneous value
	into the former.

1999-03-29  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: added definition of WIN32 because Cygwin only defines
	_WIN32, but many programs rely on WIN32 instead.

1999-03-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.c: fixed Win32 version of Delays, which was buggy if a
	delay had to cancel the previous one.  The new version is also much
	more precise.

1999-03-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: changed Integer relational operators to not do a
	toInt() (instead we use a simple typecast).

1999-03-15  Paolo Bonzini  (bonzini@gnu.org)

	*** Version 1.5.beta1 released.
	* lib/dict.c: changed to use setCObjectValueObj and cObjectValueObj.
	* lib/dict.h: doc fixes for CObject.
	* lib/dict.inl: added setCObjectValueObj and cObjectValueObj.  Now, the
	address pointed by the CObject is the LAST instance variable (including
	indexed ones), not always the SECOND (which could still be a fixed
	one).  For currently defined CObject subclasses this was not a problem,
	but it could have been a serious one if a CObject subclass declared
	additional instance variables.
	* lib/prims.inl: changed to use setCObjectValueObj and cObjectValueObj.

1999-03-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: was crashing if a call-out to a non-existent function
	was attempted.
	* lib/comp.c: fixed a strange bug I'm not sure I understood well. It
	seems that, if an error occurred in a method with literals, and if an
	immediately following method had literals, the literal array
	contained bogus data and GST would lose.  I don't think it was there
	before my March 3rd change...

1999-03-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lib.c: added --silent as a synonim of --quiet and -q.

1999-03-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: added stack depth tracing (variables and macros
	containing stackDepth).  Made makeNewMethod public, to avoid lots of
	duplicate code for the C and Smalltalk compiler.
	* lib/prims.inl: added primitive 79, which maps to makeNewMethod.
	* lib/interp.c: added support for mixed size contexts. Added
	resetFakeContexts.
	* lib/interp.c: the change above unveiled lots of bugs - especially
	uninitialized pointers here and there. In particular: a) GST would
	core dump when you did a send to super from a class without a
	superclass; b) prepareExecutionEnvironment set the stack pointer of
	the context to 0 instead of -1 so markAnOOPInternal would try to
	mark an additional stack slot.
	* lib/oop.c: In minorGCFlip, call resetFakeContexts at the end instead
	of using deallocFakeContext for every context.

1999-02-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: modified compileAssignments to use preferrably the
	`storeIndexed' bytecode. This is faster and also makes the task
	of an eventual bytecode optimizer a bit simpler.
	* lib/byte.c: added truncateByteCodes.  Moved optimizeByteCodes
	here and made it extern (it was a static in lib/comp.c), and added
	it some (working but currently not used) code.
	* lib/byte.h: added optimizeByteCodes and truncateByteCodes

1999-02-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/prims.inl: added primitive 101 (ProcessorScheduler>>
	isTimeoutProgrammed).
	* lib/dict.c: added DelayProcess and IdleProcess as
	Delay's class variables
	* lib/interp.c: in initProcessSystem, leave the processes the way
	they were unless we get here after a deadlock.

1999-02-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: changes to have an error-free compile with
	-pedantic.  Also fixed highestPriorityProcess to return the
	active process if it is not waiting on a semaphore (because
	`Processor yield' must not stop execution if the only
	runnable process is the active one).
	* lib/lex.c: Added support for -s command line option in
	isKernelFile.
	* lib/lib.c: Added -s command line option.
	* lib/oop.c: Removed arithmetics on void * in realizeOOPs.

1999-02-23  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.y: Added #'abcd' symbols (not in Smalltalk-80,
	but ANSI and common in many commercial Smalltalk
	implementations).

1999-02-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lib.c: Moved some initializations *after* parsing the
	command line (obviously *before* loading user files),
	so that parameters on the cmdline can influence the
	initialization process.

1999-02-21  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added printing of what is the erroneous method in
	sendMessageInternal.  Also renamed global SP/IP to outerSP and
	outerIP (which are then #defined to ip and sp in gst.h), so that
	there is no name collision between the local IP/SP and the global
	ones; and eliminating ipAddr/spAddr we get some more speed. But
	remember this when using GDB!!

1999-02-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Struggled to make the process system work as
	intended; it still has a few bugs but it mostly works (for
	example, philosophers now work).

1999-02-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: Started switching to generational GC!! In short,
	minor GCs only take care of fake contexts and are faster 
	because no sweeping happens; major GCs don't bother of 
	fake contexts (they assume there are none) and deal with 
	removing real unused objects.

1999-02-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.h: Added bigLiteral bytecode.
	* lib/comp.c: Changed so that methods are normal objects - no
	more variable classes and variable byte classes at
	the same time. Now, the header does not include the
	number of literals, so I also added code to use the
	new 126 bytecode.
	* lib/interp.c: Changed so that methods are normal objects - no more
	variable classes and variable byte classes at the
	same time.
	* lib/interp.inl: Changed so that methods are normal objects - no more
	variable classes and variable byte classes at the
	same time.
	* lib/prims.inl: Now methods are normal objects - no more variable
	classes and variable byte classes at the same time.
	So I removed primitives 68/69/79.
	* lib/save.c: Changed so that methods are normal objects - no more
	variable classes and variable byte classes at the
	same time.

1999-02-14  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: Experimentally moved markGlobalOOPs at the START
	of the marking phase, so that by the time the other
	objects in the root set are dealt with, many objects
	will have been marked. This might improve a bit GC
	locality of reference.
	* lib/save.c: Experimentally reorganized the global OOPs.
	smalltalkDictionary and the symbols at the END of
	the global OOP table, so that by the time they are
	marked other objects will have been dealt with and
	recursion will be more shallow; this might improve
	a bit GC locality of reference.

1999-02-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.c: using setSignalHandler() inside signalAfter().

1999-02-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/sysdep.c: getCurDirName, now performs special error handling
	when getcwd is used (code stolen from the gettext
	library's source code, by David MacKenzie).

1999-02-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: Moved incubator here from oop.h so that it is public
	* lib/oop.h: Moved incubator to gst.h so that it is public (see
	comment in GST 1.1.5 - "it is likely that this
	interface will be moved..."

1999-02-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: print new bytecode 126 for many literals, > 64.
	* lib/cint.c: Removed code to print "function not registered"
	message - Smalltalk code handles that now.
	* lib/lib.c: CFuncs.st is now loaded *after* CObject and CType -
	a logical choice since C function declarations could
	use CTypes.  Added PkgLoader.

1999-02-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/prims.inl: Sped up nextInstance by avoiding to search in the
	unused OOPs.

1999-02-05  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added callbacks #booleanRequired and #interrupt.
	Implemented bytecode 126 for many literals, > 64.
	* lib/prims.inl: Primitive 255 now does not blindly set inCCode to
	false if a C callout made a callin which in turn made
	a callout.

1999-02-04  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lex.c: Modified so that a bang is not part of a binary op.
	It's just a one-char token like [ and #.  Needs
	fixing, though.

1999-02-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/callin.c: Changed calls to yyparse() to parseStream().
	* lib/comp.c: Changed calls to yyparse() to parseStream().
	* lib/interp.c: Changed calls to yyparse() to parseStream().
	* lib/gst.y: More attempts at simplifying things around:
	now an expression invoking methodsFor: can be
	as complex as desired. In addition I changed
	temporaries and primitive to have a default value,
	so that almost-duplicated rules (e.g. `statements',
	`temporaries primitive statements', `temporaries
	statements', `temporaries primitive') can be put
	into a single one. Alas this causes 4 shift/reduce
	conflicts (2 in state 0, 2 in state 6) but Bison
	gracefully handles them and it makes the grammar more
	readable IMO.
	* lib/lex.c: Moved lex debugging here.  In addition, now
	you can compile this with NO_PARSE so that no parsing
	occurs - only lexical analysis.  To accomplish this, the
	callers need to call a function in lib/lex.c (parseStream)
	instead of yyparse().
	* lib/lib.c: Updated lex debugging and moved it to lex.c

1999-02-02  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: Added custom allocator, currently used only under
	Win32.  See comment in the file.
	* lib/alloc.h: Added custom allocator, currently used only under
	Win32.  See comment in the file.
	* lib/sym.c: internCountedString: the symbol OOP is now read only.

1999-02-01  Paolo Bonzini  (bonzini@gnu.org)

	* lib/oop.c: fix in growMemory. Now it seems to work right -
	previously, it failed if thisContext was not a fake
	and the heap moved.

1999-01-29  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: Modified isSimpleReturn so that a "return literal[0]"
	method is optimized.
	* lib/comp.c: Modified isSimpleReturn (in byte.c) so that a "return
	literal[0]" method is optimized. The "primitive must
	be executed" case, which was previously identified by
	flags == 3, is now identified by primitiveIndex != 0.

1999-01-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: Moved regressionTesting to lib.c; it seems more
	logical to me.
	* lib/gst.h: fix in incrInt/decrInt: it was not converting the
	OOP to a long before adding 2 - so it was actually
	adding sizeof(OOP)*2 = 16!
	* lib/lib.c: to make -S work when -i was specified too.
	* lib/oop.c: nilOOP, trueOOP and falseOOP are now initialized in
	allocOOPTable(), not initOOPTable(). Actually I can't
	guess why they weren't there in the first place.
	* lib/prims.inl: Added check for already closed file in fileOp: (if
	fileStream->file = nilOOP, fail). Added flushPrim
	and getBytePrim.
	* lib/save.c: Removed experimentally the code that saves and
	restores nil, true, false and the characters:
	why can't we initialize them just like if we were
	initializing the system from scratch, without
	an image?
	* lib/sysdep.c: openFile, removed references to BINARY_MODE_NEEDED
	(I had to remove it from the configure script because
	it did not work correctly, at least under Cygnus'
	Win32 port.

1999-01-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Smalltalk dictionary is now created with a larger
	size than it used to be (see the definition of INITIAL_SMALLTALK_SIZE).
	* lib/interp.c: Made the method cache an array of a struct instead of
	five different arrays.  A "return literal" method is
	optimized like "return self" and "return inst. var".

1999-01-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: Removed code for evaluating (parse last statement as
	return) - not needed since Smalltalk code implements
	evaluate: Also changed references to findVariable to
	prevent assignments into arguments.
	* lib/gst.y: Removed code to parse last statement as return -
	not needed since Smalltalk code implements evaluate:
	* lib/lex.c: Modified to have a variable indicating the name of
	the log file.
	* lib/lib.c: Changed -v to exit after the output, like
	--version. Added -l and -L to log to a file. Added
	long options.
	* lib/sym.c: Modified findVariable and localVarIndex so that
	assignments to arguments are detected.

1999-01-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.inl: Spiffed it up with a few register clauses.
	Also removed modulus operator (%) when possible.
	This increased performance (especially in message
	sends) only by 5%, but it was so easy I could not
	but do it!

1999-01-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/alloc.c: Added this banner.
	* lib/alloc.h: created.
	* lib/lex.c: Fixed lineStamp() so that the format is consistent
	with GCC and other GNU programs: for example,
	"Integer.st:115: parse error")

1999-01-22  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: Moved SIG_ARG_TYPE from sysdep.c here.  Added paranoic
	checking of memset arguments when bzero is used.
	* lib/interp.c: Moved SIG_ARG_TYPE to gst.h
	* lib/sysdep.c: Moved SIG_ARG_TYPE to gst.h

1999-01-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.inl: Fixed bug in large integers.  I was not considering
	that the product of the low-order 15 bits could exceed 15 bits!

1999-01-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.h: Added byteStreamClass.
	* lib/interp.c: Yesterday I removed maxSize instance variable from
	WriteStream, so I had to remove it from the FileStream
	struct, either.
	* lib/lib.c: Added ByteStream.st.
	* lib/save.c: Added byteStreamClass.

1999-01-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Removed maxSize instance variable from WriteStream.
	Fixed missing isPipe parameter in addSTDIOObject.
	Added ByteStream.  Added CShortSize global.

1999-01-13  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: Added getArgc and getArgv
	* lib/lib.c: Added ability to get argc/argv from Smalltalk code.
	* lib/sysdep.c: Fixed a small & invisible error, a 'start of comment'
	misplaced for a 'end of comment' (note by Paolo Bonzini  (bonzini@gnu.org):
	congratulations for your sharp eye!!)

1999-01-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Yeah! Removed bitfields from InstanceSpec!!
	* lib/dict.h: Yeah! Removed bitfields from InstanceSpec!!
	* lib/dict.inl: Yeah! Removed bitfields from InstanceSpec!!
	* lib/gst.h: Yeah! Removed bitfields from InstanceSpec!!
	* lib/prims.inl: Yeah! Removed bitfields from InstanceSpec!!

1999-01-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Good!!  First change in 1999!!  Optimized out send to
	super.  I renamed sendMessage to sendMessageInternal
	and created two macros (sendMessage and sendToSuper)
	in interp.inl
	* lib/interp.h: Good!!  First change in 1999!!  Optimized out send to
	super.  I renamed sendMessage to sendMessageInternal
	and created two macros (sendMessage and sendToSuper)
	in interp.inl
	* lib/interp.inl: Good!!  First change in 1999!!  Optimized out send to
	super.  I renamed sendMessage to sendMessageInternal
	in interp.c and created two macros (sendMessage and
	sendToSuper) here.

1998-12-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: Added my_stat for portability
	* lib/oop.c: Moved the code to nil out weak references *before*
	sweeping is done.  This is needed so that finalize
	methods which refer to weak objects already see nils.

1998-12-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/prims.inl: added ability to create subclasses of CompiledMethod
	(for now, cannot add instance variables)

1998-11-28  Paolo Bonzini  (bonzini@gnu.org)

	* lib/comp.c: The method cache was not properly updated:
	test 1 to: 5 do: [ :i | Object compile: 'foo ^',
	i printString. (nil foo) printNl] now I'm using
	invalidateMethodCache instead of updateMethodCache
	(see interp.c).
	* lib/interp.c: fix: since updateMethodCache did not always work
	I replaced it with invalidateMethodCache, which
	is not as gentle but works (anyway compiles are
	not so frequent and it takes nothing to rebuild a
	good cache).  Also, thisContext's ip and sp (in
	sendMessage and sendBlockValue) are now updated
	*after* thisContextOOP is set to the newly created
	context.  The previous implementation caused mess if
	allocFakeContext() triggered a GC.

1998-11-27  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Added the Table class variable to Character.
	* lib/gst.h: Added finalization.
	* lib/oop.c: Added finalization.  Also added lastUsedOOP which
	is used to shorten the loops on the OOP table at GC
	time It was needed because the OOP table was scanned
	three times: once to mark dependents of finalizable
	objects, once to reverse pointers (prepareForSweep),
	once to scan for objects to be finalized.  Now the
	whole GC is on average 50% faster than it used to be
	BEFORE having to add all these cycles.
	* lib/oop.inl: created
	* lib/prims.inl: added finalization primitives 256-257
	* lib/sym.c: Added finalizeSymbol.
	* lib/sym.h: Added finalizeSymbol

1998-11-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.inl: created

1998-11-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Moved many routines to dict.inl for speed.  Changed
	BlockClosure to a byte-subclass to save eight bytes.
	* lib/dict.h: Moved most things to gst.h, added dict.inl
	* lib/dict.inl: created
	* lib/interp.c: Added primitive 104 (String hash function), inlined
	many things around.
	* lib/oop.c: Changed the way the marking system works.  Instead of
	two entry points (markAnOOP and markOOPRange) both
	relying on markAnOOPInternal and passing parameters
	to it through the copy stack, I have two macros
	(maybeMarkOOP and markOOPRange) which pass parameters
	to markAnOOPInternal through function arguments.
	markAnOOPInternal does its job calling itself
	recursively, doing everything on the stack without
	expensive mallocs.  This makes the code neater, since
	the whole marking system resides in a single function.
	* lib/prims.inl: created from interp.c
	* lib/sym.c: Modified hashString to be more effective.

1998-11-24  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lib.c: Added ContextPart.st, changed to try loading .stinit
	and .stpre from the current directory if the HOME
	environment variable is not found (fix for Win32).

1998-11-11  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Fixed bug in asObject primitive.  Was erroneously
	using oopAt(arg1-1) instead of oopAt(arg1).

1998-11-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/lex.c: Fixed so that _ *inside* an identifier is OK.

1998-11-08  Paolo Bonzini  (bonzini@gnu.org)

	* lib/byte.c: Added notNilSymbol and isNilSymbol.
	* lib/byte.h: Added notNilSymbol and isNilSymbol
	* lib/interp.c: Fixed bugs in returnWithValue (they had been there
	since 18 Oct...): contexts were returned to the free
	fake list even if they were not fake anymore (which
	happened if you did a snapshot).  Sooner or later, a
	normal object contended the same heap space with these
	contexts, wreaking havoc on the image. Also turned
	noParentContext to a macro and added notNil/isNil as
	bytecodes 206 and 207; these are optimized out to gain
	speed in some operations (e.g. Sets and Dictionaries).
	* lib/save.c: Added notNilSymbol and isNilSymbol
	* lib/sym.c: Added notNilSymbol and isNilSymbol.
	* lib/sym.h: Added notNilSymbol and isNilSymbol

1998-11-01  Paolo Bonzini  (bonzini@gnu.org)

	* lib/callin.c: Added vmsgSend.  Moved mstMalloc and mstGetCData here.

1998-10-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gstpub.h: Added vmsgSend.

1998-10-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Changed fake OOPs so that they have entries in the
	real OOP table.  This allows me to never realize
	the fake contexts unless a snapshot is being done.
	Less GC = more speed!!
	* lib/oop.c: Fake OOPs are now in the main OOP table.  Changed
	setOOPObject to a macro for SPEED!!
	* lib/oop.h: Added freeOOP(), realizeAllOOPs()

1998-10-16  Paolo Bonzini  (bonzini@gnu.org)

	* lib/cint.c: Added stringOut return type (frees string)

1998-10-15  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added type 9 for CObjects and Memory (smalltalk OOP)

1998-10-12  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Added BlockClosure.  Changed BlockContext to reflect
	new architecture.  Changed Float to a variable
	byte class.
	* lib/interp.c: Added support for blocks as closures (partly I wrote
	it, part I stole it from Steve Byrne  (sbb@gnu.org)'s never made public
	1.1.6 version).  Started adding support for fake
	block contexts (see 1   Jan  91)

1998-10-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added support for read-only objects (prims 233-234)

1998-09-26  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Fixed allocCObject.  Added IdentitySet.

1998-09-25  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added a few register clauses.  Also changed
	implementation of "send ==" so it doesn't actually do
	the message sends, since == should not be overridden.
	* lib/lib.c: Added ValueAdapt.st, File.st, Directory.st,
	IdentitySet.st
	* lib/oop.c: Added a free list to OOP table.  This yielded, in
	general, good performance boosts, up to ten-fold for
	snippets that heavily allocate objects!! (on average,
	the number of bytecodes per second doubled)
	* lib/oop.h: Added refreshOOPFreeList(), to be used by save.c

1998-09-18  Paolo Bonzini  (bonzini@gnu.org)

	* lib/gst.h: Started adding support for read-only objects.
	* lib/interp.c: Removed last vestiges of previous garbage
	collectors. Removing loops that were not optimized
	out by compilers caused a 30% performance increase
	(not joking!).  Y2K change...  Time>>secondClock was
	about to overflow.  Also fixed sendBlockValue to
	check argument count.
	* lib/oop.c: Removed all vestiges of previous GC algorithms.
	This was a pity because it was really instructive
	but I was not able to read anything before ;-).
	* lib/oop.h: Fixed incubator bug (incAddOOP not in braces),
	removed maybeMoveOOP and localMaybeMoveOOP.

1998-09-10  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Added LargeIntegers and Fractions.  Tried to make
	nilFill faster.
	* lib/lib.c: Added LargeInteger.st, removed changes.st since its
	changes are incorporated in Fraction.st

1998-09-09  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Started adding support for LargeIntegers!!!

1998-09-07  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: Added Behavior>>#flushCache (primitive 89,
	as in the Blue Book).  Added bounds checking to	spaceGrowRate:
	(between 0 and 500)

1998-09-06  Paolo Bonzini  (bonzini@gnu.org)

	* lib/interp.c: FileStream>>nextPutAll: primitive was giving access
	violations (!) if Integers were passed... definitely
	too greedy!  I've updated the Smalltalk code too, so
	that it handles the case, but anyway now the primitive
	fails.  On 3 Sep 98 I had broken Floats; fixed.

1998-09-03  Paolo Bonzini  (bonzini@gnu.org)

	* lib/dict.c: Added extensions to Date, modified Collection and
	SequenceableCollection so they are not indexable.
	Removed LookupKey.
	* lib/interp.c: Switched to openFile; corrected bug in floating point
	arithmetic primitives which never failed.  basicPrint
	doesn't output new-line.  Also corrected so that,
	when aborting execution, dead contexts are ignored
	and don't cause "Block returning to non-existent
	method context" errors.
	* lib/lib.c: Modified to use openFile, added a few loaded modules.

1998-09-02  Paolo Bonzini  (bonzini@gnu.org)

	*** Began development of version 1.6
	* lib/save.c: Switched to using openFile to open files
	* lib/sysdep.c: Added openFile, support for Cygnus Win32 added. A
	note on this is important.  Reluctantly I used Win32
	functions here and there.  I was not happy about that,
	but since it's the only way to do some things in
	an environment that does not fully comply to POSIX,
	I had to.

1995-12-16  Steve Byrne  (sbb@gnu.org)

	* lib/comp.c: Changed name to blockCopyColonTemporariesColonSymbol.
	* lib/sym.c: Changed name to blockCopyColonTemporariesColonSymbol.
	* lib/sym.h: Changed name to blockCopyColonTemporariesColonSymbol.

1995-11-04  Steve Byrne  (sbb@gnu.org)

	* lib/oop.c: Fixed allocObj to have what I think is the *right*
	algorithm -- simple, grows when needed.

1995-11-02  Steve Byrne  (sbb@gnu.org)

	* lib/oop.c: Fixed allocObj to properly grow when not enough
	space is required, and to terminate if the allocation
	cannot succeed.

1995-10-15  Steve Byrne  (sbb@gnu.org)

	* lib/byte.h: Added pushOuterTempVariable and storeOuterTempVariable
	byte codes.
	* lib/sym.c: Converted to the new architecture; introduced the
	notion of scopes.
	* lib/sym.h: Converted to new architecture; introduced the notion
	of scopes.

1995-10-14  Steve Byrne  (sbb@gnu.org)

	* lib/gst.y: Began adding block temporary syntax.
	* lib/tree.c: Added support for block node type for new
	architecture.
	* lib/tree.h: Added block node type for new architecture support.

1995-09-30  Steve Byrne  (sbb@gnu.org)

	*** Version 1.1.5 released.

1995-09-16  Steve Byrne  (sbb@gnu.org)

	* lib/interp.c: Moved lots of system dependent functions out to
	sysdep.
	* lib/sysdep.h: Added openPipe, closePipe, getOpenFileSize.

1995-09-10  Steve Byrne  (sbb@gnu.org)

	* lib/interp.c: Switched to fileIsReadable sysdep routine.
	* lib/lib.c: Added -g command line flag to suppress printing of
	GC messages.
	* lib/oop.c: Added GC torture test.  Heh heh heh!
	* lib/sym.c: Added incubator usage.
	* lib/sysdep.c: Added fileIsReadable, also setSignalHandler, and
	initSysdep.

1995-09-09  Steve Byrne  (sbb@gnu.org)

	* lib/callin.c: Added incubator usage.
	* lib/cint.c: Added incubator support for created objects.
	* lib/cint.c: Removed Sun Windows hacks from the file.
	* lib/interp.c: Added code to use the object incubator support.
	* lib/interp.c: Experimentally tried to next jmp_bufs so enable proper
	handling of reentering the interpreter from C callout
	code and then calling out to more C code.

1995-09-08  Steve Byrne  (sbb@gnu.org)

	* lib/dict.c: Added incubator support for newly created objects.

1995-09-07  Steve Byrne  (sbb@gnu.org)

	* lib/comp.c: Added usage of OOP incubator.
	* lib/oop.c: Added incubator support.
	* lib/oop.h: Added incubator support.

1995-08-30  Steve Byrne  (sbb@gnu.org)

	* lib/gst.h: Merged in Visual C++ changes.
	* lib/oop.c: Merged NT changes back in.  Code now contains some
	unnecessary casting and unrolled expressions (*=
	becomes = *) to shut the Visual C++ compiler's
	warnings off.

1995-08-26  Steve Byrne  (sbb@gnu.org)

	* lib/comp.c: Merged Brad Diller's changes for dealing with parsing
	specially in the browser.
	* lib/dict.c: Added kernel and image file paths as Smalltalk
	accessible variables.
	* lib/lib.h: Added kernelFileDefaultPath and imageFileDefaultPath
	as exported symbols.
	* lib/sysdep.c: Fixed to have the __cursigmask definition be
	conditional on HAVE_SIGHOLD.

1995-08-20  Steve Byrne  (sbb@gnu.org)

	* lib/oop.c: Added growMemoryTo(); it's a variant of growTo which
	does not involve the garbage collector.
	* lib/oop.c: Fixed alignSize to not double align (we don't
	preserve that property during GC anymore anyway,
	and the floating point accessing functions in dict.c
	which were the initial reason for having it are now
	sensitive to whether aligned access to doubles is
	required by the hardware or not.
	* lib/oop.h: Added growMemoryTo().
	* lib/save.c: Switched to using growMemoryTo in loadFromFile so
	that if the saved image space is larger than the
	normal memory space, the space is grown to fit.

1995-07-26  Steve Byrne  (sbb@gnu.org)

	* lib/cint.c: Fixed the makeDescriptor function to issue an error if
	it cannot find a named C function.  Already located
	some bugs in UnixStream.st which have been there
	since it's inception.

1995-07-23  Steve Byrne  (sbb@gnu.org)

	* lib/comp.c: Removed apostrophes in comments -- OS/2 doesnt
	like them.  (Incredible!)
	* lib/dict.c: Added CIntSize so that C struct can understand
	int size.
	* lib/gst.h: Removed mstconfig.h!!! Code is now not conditional
	on the presence of config.h.
	* lib/interp.c: Merged in OS/2 diffs, and removed apostrophes from
	preprocessed-out code (OS/2's preprocessor doesn't
	understand backslash quoting.
	* lib/oop.c: Fixed #ifdefed out code to not have apostrophes
	(OS/2 doesn't understand).
	* lib/save.c: Removed extra stdio.h include

1995-07-13  Steve Byrne  (sbb@gnu.org)

	* lib/comp.c: Removed HAVE_ALLOCA_H.
	* lib/save.c: Removed HAVE_ALLOCA_H include of alloca.h (done in
	gst.h now).
	* lib/sym.c: Removed HAVE_ALLOCA_H.

1995-07-11  Steve Byrne  (sbb@gnu.org)

	* lib/cint.c: Added John Stanhope (jehu@vt.edu)'s changes for
	Objective-C calling (Thanks John!!!)
	* lib/gstpub.h: Added defineCFunc.
	* lib/save.c: Added John Stanhope (jehu@vt.edu)'s changes for
	Objective-C calling (Thanks John!!!)
	* lib/sym.c: Added John Stanhope (jehu@vt.edu)'s changes for
	Objective-C calling (Thanks John!!!)
	* lib/sym.h: Added John Stanhope (jehu@vt.edu)'s changes for
	Objective-C calling (Thanks John!!!)

1995-07-09  Steve Byrne  (sbb@gnu.org)

	* lib/byte.c: Fixed to include proper headers.
	* lib/callin.c: Fixed to include correct header files.
	* lib/comp.c: Fixed to include proper headers and have explicit
	declarations.
	* lib/dict.c: Fixed to explictly declare functions and include
	proper files.
	* lib/interp.c: Fixed to have explicit function declarations and
	correct include files.
	* lib/lex.c: Fixed to include proper headers and have functions
	declared explictly.
	* lib/oop.h: Added lots of new externs.
	* lib/save.c: Fixed to have proper inclues and explicit function
	declarations.
	* lib/tree.c: Fixed to include correct files.

1995-07-08  Steve Byrne  (sbb@gnu.org)

	* lib/lib.c: Fixed a bunch of declarations and includes so that
	functions are now explictly declared always.

1995-06-29  Steve Byrne  (sbb@gnu.org)

	* lib/sym.c: Fixed pool dictionary allocation to not allocate a
	large number of immediately thrown away arrays.

1995-06-26  Steve Byrne  (sbb@gnu.org)

	* lib/gst.h: Switched EMPTY_BYTES to be 8 byte into the word
	instead of the low bytes to make the low bytes unused
	for use with the mark/sweep GC.

1995-06-23  Steve Byrne  (sbb@gnu.org)

	* lib/cint.h: switched guard prefix to GST
	* lib/comp.h: Switched to GST guard prefix
	* lib/dict.h: switched to GST guard prefix
	* lib/gst.h: Switched to GST header guard.
	* lib/gstpaths.h: Switched to GST header guard prefix.
	* lib/gstpub.h: Switched to GST header guard prefix.
	* lib/id.h: Switched to GST header guard prefix.
	* lib/interp.h: Switched to GST header guard prefix.
	* lib/lex.h: Switched to GST header guard prefix.
	* lib/lib.h: Switched to GST header guard prefix.
	* lib/oop.h: Switched to GST header guard prefix.
	* lib/save.h: Switched to GST header guard prefix.
	* lib/str.h: Switched to GST header guard prefix.
	* lib/sym.h: Switched to GST header guard prefix.
	* lib/sysdep.h: Switched to GST header guard prefix.
	* lib/tree.h: Switched to GST header guard prefix.

1995-06-15  Brad Diller

	* lib/comp.c: Modified executeStatements() to support browser
	expression evaluation.  Added getByteCodeForSpecialSelector() to
	support some browser operations.
	* lib/comp.c: Store in memory the source code derived from .st
	files loaded outside the kernel directory.
	* lib/comp.h: Added getByteCodeForSpecialSelector() to support some
	browser operations.
	* lib/lex.c: Added isKernelFile() and getMethodSourceFromCurFile().
	These routines were provided to solve certain data
	integrity problem caused by accessing the source code
	indirectly from saved file information.
	* lib/lex.h: Added isKernelFile() and getMethodSourceFromCurFile().

1995-06-09  Steve Byrne  (sbb@gnu.org)

	* lib/oop.c: Began switching to compacting mark & sweep gc.
	* lib/oop.h: Began the conversion to single GC space.

1995-06-06  Steve Byrne  (sbb@gnu.org)

	* lib/byte.c: Switched to new file naming scheme.
	* lib/callin.c: Switched to new file naming scheme.
	* lib/cfuncs.c: Switched to new file naming scheme.
	* lib/cint.c: Switched to new file naming scheme.
	* lib/comp.c: Switched to new naming scheme.
	* lib/comp.h: Switched to new file naming scheme.
	* lib/dict.c: Switched to new file naming scheme.
	* lib/gstpub.h: Switched to new file naming scheme.
	* lib/id.c: Switched to new file naming scheme.
	* lib/interp.c: Switched to new file naming scheme.
	* lib/lex.c: Switched to new file naming scheme.
	* lib/lib.c: Switched to new naming scheme.
	* lib/lib.h: Switched to new file naming scheme.
	* lib/oop.c: Switched to new file naming scheme.
	* lib/save.c: Switched to new file naming scheme.
	* lib/str.c: Switched to new file naming scheme.
	* lib/sym.c: Switched to new file naming scheme.
	* lib/sysdep.c: Switched to new file naming scheme.
	* lib/tree.c: Switched to new file naming scheme.

1995-06-05  Steve Byrne  (sbb@gnu.org)

	* lib/mstpub.h: Merged in Brad Diller's changes.

1995-05-31  Steve Byrne  (sbb@gnu.org)

	* lib/mstcint.c: Fixed cFuncInfo to grow dynamically.
	* lib/mst.h: Boolean replaced with mst_Boolean, objectClass =>
	mst_objectClass, Object => mst_Object.  This thanks
	to the foresightful guys at the X consortium.
	Thanks guys for wantonly chewing up name space.
	* lib/mst.h: Removed the old sysVersionMajor etc definitions --
	they are now defined in configure.in.

1995-05-30  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.c: Replaced objectClass with mst_objectClass.  Boolean =>
	mst_Boolean.
	* lib/mstcomp.h: Boolean switched to mst_Boolean.
	* lib/mstdict.c: Replaced objectClass with mst_objectClass to avoid
	conflicts with X (grrr!).  Boolean replaced with
	mst_Boolean.  Object replaced with mst_Object.
	* lib/mstdict.h: Replaced objectClass with mst_objectClass to avoid
	conflicts with X.  Boolean => mst_Boolean. Object =>
	mst_Object.
	* lib/mstinterp.c: Replaced objectClass with mst_objectClass.  Boolean =>
	mst_Boolean.
	* lib/mstinterp.h: Boolean => mst_Boolean.
	* lib/mstlex.c: Boolean => mst_Boolean.
	* lib/mstlex.h: Boolean => mst_Boolean (darn X!).
	* lib/mstlib.c: Boolean => mst_Boolean.
	* lib/mstlib.h: Boolean renamed to mst_Boolean.
	* lib/mstoop.c: Boolean => mst_Boolean.
	* lib/mstoop.h: Boolean => mst_Boolean.  Object => mst_Object.
	* lib/mstsave.c: Boolean => mst_Boolean.  Object => mst_Object.
	* lib/mstsave.h: Boolean => mst_Boolean.
	* lib/mstsym.c: Boolean => mst_Boolean.
	* lib/msttree.h: Boolean => mst_Boolean.

1995-05-28  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Finally hacked floatNew to deal properly on
	architectures where double alignment requirements
	are different from those of long.
	* lib/mstsysdep.c: Added getdtablesize for those systems such as HP
	which do not have this useful function.
	* lib/mstsysdep.c: Fixed getCurDirName to selectively use getwd or getcwd
	depending on what is supported.

1995-05-15  Brad Diller

	* lib/mstinterp.c: Added primitives 256-264 to support expression
	evaluation and other functions for the class browser.

1995-05-07  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Added more machine specific datatype constants (size
	and alignment).
	* lib/msttree.h: removed trailing comma from NodeType enum literals
	list -- some compilers are picky.

1995-04-29  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Added CDoubleAlignment as a 'global' value for the
	required alignment of C type 'double'.
	* lib/mstlib.c: Moved CType to after CObject in the load order to
	better reflect the type (and symbol definition)
	dependencies.

1995-03-31  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.c: Compiler now uses the initEmptyBytes macro to set
	the empty bytes of the byte code length of a method.
	* lib/mst.h: Adjusted EMPTY_BYTES related constants to vary with
	hardware architecture.
	* lib/mstinterp.c: Fixed branching backward to use signed arithmetic it
	was doing the computation as unsigned ints without
	sign extension when it was added ot a 64 bit pointer.
	* lib/mstoop.c: Added fflush(stdout) to some debugging funcs
	* lib/mstsym.c: Adjusted a reference to the empty bytes to use the
	new, architecture independent macro definitions.

1995-03-19  Brad Diller

	* lib/mstcint.c: Conditionally enable GC of Smalltalk objects
	referenced in callouts.

1995-03-15  Brad Diller

	* lib/mstdict.c: added mstMalloc mstGetCData.

1995-03-01  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.c: Fixed makeConstantOOP to handle NIL which is passed
	in from empty array literals.

1995-01-21  Steve Byrne  (sbb@gnu.org)

	* lib/mstlex.c: Some changes for architectural independence (64 bit).

1995-01-20  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.h: Added 64 bit support.
	* lib/mst.h: More changes for DEC Alpha 64bit architecture.
	* lib/mstinterp.c: Adjusted for DEC Alpha 64bit architecture.
	* lib/mstinterp.h: Added padding for 64bit architectures.

1995-01-14  Steve Byrne  (sbb@gnu.org)

	* cxtnsn/dld.c: Changed the name from DLD to USE_DLD to avoid
	conflicts with symbols defined by the DLD package in the future.

1995-01-05  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Fixed a bug when copying a fake method context
	(ip wasn't being updated, and so was pointing to
	dead storage).

1995-01-02  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Fixed CType to use the new type model.
	* lib/mstdict.h: Switched to the new CType model.
	* lib/mstinterp.c: Removed primitives 147 & 148 -- they were obsolete
	anyway, and now with the new CType model they no
	longer function.

1994-12-03  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Added code stubs for asCData: primitives.

1994-11-16  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Finally tracked down some problems with prims 183-185
	-- they were using the wrong variable to access the
	contents of the cobject, and it was just luck that
	it worked on Linux.

1994-10-08  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.c: Fixed some bugs related to getting a GC during
	compilation (literals during compilation are part of
	the root set, etc.).
	* lib/mstinterp.c: Added SystemDictionary>>growTo: and moved a few
	builtins around.
	* lib/mstsym.c: Fixed the internCountedString bug by deferring OOP
	allocation until all instances have ben allocated.

1994-10-02  Steve Byrne  (sbb@gnu.org)

	* lib/mstoop.c: Made sure to turn off the free bit in moveOOP (no
	sense in moving an object that's freed, and moveOOP
	will not be called on a truly freed object; this
	change "repairs the damage" in cases where there is
	an accidental freeing occurring.
	* lib/mstsym.c: Fixed a bug in internCountedString that occurs other
	places where there is the possibility of doing a
	garbage collection just after a newly allocated object
	which has not been added to a root-set-reachable
	object.  The GC sees that there are no references
	to the new object, and marks its oop free and does
	not copy the just allocated object into the new
	current semispace.  This problem can occur anywhere
	these conditions occur.  Given that allocOOP moves the
	object to the current space if it's not already there,
	for this case to really occur, you have to have done
	the allocOOP before you call the second instantiate
	or other allocation primitive.

1994-09-20  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Added empty statement to the tail of a case statement.

1994-09-15  Steve Byrne  (sbb@gnu.org)

	*** Version 1.2.alpha1 released.

1994-09-04  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.c: Fixed some of the printing at the end of
	executeStatements to avoid dividing by zero.
	* lib/mstdict.c: switched out last bzero call.
	* lib/mst.h: More changes -- removed some old bcopy macro
	definitions, and switched more towards the autoconf
	based implementation.

1994-09-03  Steve Byrne  (sbb@gnu.org)

	* lib/cfuncs.c: Created.
	* lib/cfuncs.c: This is the first file in the distribution to not
	start with "mst".  This is the precursor to having
	short file names so that primitive operating systems
	can deal with an advanced system like Smalltalk :-) :-) :-).
	* lib/mstcint.c: Factored out initUserCFuncs to enable easier extension
	by developers.
	* lib/mstcint.c: Yanked out DLD -- it's now in the parent directory.
	* lib/mst.h: Switched double size out, switched to use RETSIGTYPE,
	and WORDS_BIGENDIAN.
	* lib/mst.h: Switched to having version defines coming from the
	config.h file, and added the edit prefix string.

1994-08-31  Steve Byrne  (sbb@gnu.org)

	* lib/mst.h: Began switching to autoconf based approach.

1994-08-24  Steve Byrne  (sbb@gnu.org)

	* lib/mst.h: Added symbolic constants for max and min integer
	values representable in a Smalltalk Integer object.
	* lib/mstinterp.c: Fixed Float>>truncated to do range checking and fail
	if converting a number that is outside the range
	of integers.

1994-08-21  Steve Byrne  (sbb@gnu.org)

	* lib/mstcomp.h: Switched to using low bit int marking.
	* lib/mstdict.h: switched to low order bit for int flagging.
	* lib/mst.h: Switched to low order bit for int flagging.

1994-07-10  Steve Byrne  (sbb@gnu.org)

	* lib/mstlex.c: Reinstated the use of changes (it was dyked out)
	as an optional mechanism.

1994-07-09  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Fixed findKey to check all elements even when the
	dictionary is full.  Previously it would check all but
	the last one, which caused some bizarre compilation
	behavior (the last class declared didn't seem to be
	there as far as the compiler was concerned).

1994-06-22  Steve Byrne  (sbb@gnu.org)

	* lib/mstcint.c: Added support for cObjectPtr type, to allow for
	passing CObject parameters by reference.  It is up
	to the client to ensure that the passed CObject type
	corresponds to the desired C datatype.

1994-06-20  Steve Byrne  (sbb@gnu.org)

	* lib/mstcint.c: Fixed stringInfo to be local to the call stack,
	instead of using a static, to allow recursive
	invocations.

1994-06-11  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Added new-style CObject accessors functions, currently
	in the range 182 -- 189.
	* lib/mstsym.c: Added cObjectPtrSymbol for new call by value parameter
	passing mode.
	* lib/mstsym.h: Added cObjectPtrSymbol.

1994-04-30  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Added CPtr incrBy:

1994-03-19  Steve Byrne  (sbb@gnu.org)

	* lib/mstcallin.c: Added %t and %T for more direct control over
	types. Also, added typeNameToOOP for mapping string
	type names to actual CType subclass instances.

1993-10-16  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.h: Changed to have 9 priority levels, as part of the
	fix for ProcessorScheduler>>yield.

1993-10-10  Steve Byrne  (sbb@gnu.org)

	* lib/mstinterp.c: Doing some experimental hacks on the process system
	to try to recover from the case where there are no
	runnable processes.
	* lib/mstinterp.h: Fixed definition of initProcessSystem.

1993-04-04  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: made printAssociationKey more bullet-proof when passed
	a non-association.

1992-11-22  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Added isPipe member to FileStream.
	* lib/mstinterp.c: Fixed FileStream to have a buffer instance variable,
	and added knowledge of whether the file stream was
	a regular file or a pipe, so FileStream>>close could
	do the right thing.

1992-07-18  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: added byteArrayNew.
	* lib/mstdict.c: added countedStringNew.

1992-07-16  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: added freeCObject.

1992-05-25  Steve Byrne  (sbb@gnu.org)

	* lib/mstdict.c: Added support for Emacs caching class names.
	* lib/mstinterp.c: Made system interruptable when non-interactive
	(interrupts work, that is).

1992-02-23  Steve Byrne  (sbb@gnu.org)

	* lib/mstcint.c: Added support for reading and writing scalar types.

1992-01-01  Steve Byrne  (sbb@gnu.org)

	* lib/mstcallin.c: Fixed to auto-initialize Smalltalk when the public
	routines are invoked.
	* lib/mstpub.h: Created.
	* lib/mstlib.c: Converted to be callable as a library.
	* lib/mstlib.h: Renamed from mstmain.h
	* main.c: Created from old mstmain.c (now mstlib.c)

1991-12-31  Steve Byrne  (sbb@gnu.org)

	* mstcallin.c: Created.
	* mstcallin.h: Created.
	* mstlex.c: Began adding support for having a changes file and
	pointing methods to that instead of the actual source
	file (which can get out of sync, and cause recompiles
	to lose).
	* mstoop.c: Added registered oops to root set.
	* mstoop.c: oopTable now allocated from memory instead of being
	stored as part of the executable.

1991-12-29  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added support for readline's conditional .inputrc
	definitions, keyed off of "Smalltalk".

1991-12-22  P. Lecoanet

	* mstbyte.c: Fixed byteCodeLength failing to return 0

1991-12-08  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Changed oopValid to only check the FREE bit, instead
	of worrying about the even odd flags, which may not
	be valid.

1991-11-29  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added fileNameOOP to hold full path name for files,
	so that all methods share the same file name string.
	Also, adjusted getCurFileName to return the full
	path name.

1991-11-28  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added SystemDictionary byteCodeCounter primitive.
	* mstsysdep.c: Added getCurDirName() for allowing compiler to record
	the full file name that is used.

1991-11-24  Steve Byrne  (sbb@gnu.org)

	* mstinterp.h: Context size increased to 64 (still not enough),
	to prevent inadvertent stomping of memory past the
	end of the stack.

1991-11-09  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Fixed new: to indicate failure when failure occurs.

1991-11-02  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Altered the logic in the primitive replace from code
	-- I don't think it was really wrong, but it wasn't
	as clear as it might have been.
	* mstinterp.c: Fixed instVarAt: to obey real stack conventions
	(was pushing instead of setting the stack top).

1991-10-20  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added support for user level control of memory space
	growth rate parameters.
	* mstoop.c: Support for growing now fully operational (and no,
	it hasn't taken me over a month to track down the
	problems; free time has been nil).  Also removed more
	vestiges of the incremental GC.

1991-09-15  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Fixed dictionaryAssociationAt: to not loop when the
	dictionary is full.  Thanks to Michael Richardson
	for the fix!
	* mstinterp.c: Added quitPrimitive: to allow for non-zero exit
	statuses.
	* mstoop.c: Added support for loading larger semispaces from
	saved images.

1991-09-14  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Switched to global version string.
	* mst.h: Added edit version support.
	* mstinterp.h: Increased number of literals to 256, number of
	temporaries to 64, and number of allowable primitives
	to 1024 (overkill?)
	* mstmain.c: Added edit version support.
	* mstmain.h: Added edit version support.
	* mstsave.c: Added support for edit version.

1991-09-12  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Fixed -I argument parsing code to properly gobble up
	the file name.

1991-08-04  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Removed more vestiges of the incremental GC, began
	switchover to automatically growing semi-spaces.

1991-07-19  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Started adding support for the DLD package.
	* mstmain.c: Started adding conditional support for the DLD
	package.

1991-07-06  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: added newString (create uninitialized string of a
	given length).

1991-07-05  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added primitive 248: `FileStream fileInLine: lineNum
	fileName: aString at: charPosInt'; this helps improve
	things for the emacs interface by making recorded
	information accurate, and making error locations also
	be accurate.
	* mstinterp.c: Added support for primitive 105, which is the basic
	fast support for doing replacement within strings.
	* mstlex.c: Added setStreamInfo so that stuff filed in from Emacs
	can have more accurate information such as the line
	number in the buffer instead of the line number in
	the temporary file.

1991-07-02  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Fixed handling of jump true and jump false opcodes:
	they now issue an error if invoked with non trueOOP
	or falseOOP.

1991-04-19  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Added skipCompilation boolean, for conditional
	compilation.
	* mstinterp.c: Added primitive to support conditional compilation.

1991-04-13  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Added Features global variable.  This allows for
	conditional execution based on operating system or
	machine architecture, and at some point, conditional
	compilation.

1991-03-25  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added -> operator.

1991-03-24  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Float's class definition said that it was not
	pointers, not words, and not indexable.  When new
	instances were created, they were 2 BYTES large,
	instead of 2 words.  Changed to have the words flag
	* mstlex.c: Fixed lexing of foo:= to be seen as foo :=.
	* mstmain.c: Added loading of changes.st

1991-03-23  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Fixed a bug with process switching: you can't depend
	on objects gotten with oopToObj after a prepareToStore
	into the parent object: it may have moved, and you're
	storing into dead storage.
	* mstinterp.c: Improved speed another 50% by "inlining" many of the
	special selectors that the compiler uses.

1991-03-17  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added support for C-style interrupts (signals) and
	timed interrupts to help with time slicing.

1991-02-16  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Recursive calls to equalConstant had the arguments
	reversed.

1991-01-27  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Modified the definition of the inline-controlling
	macro so that inlining is always selected when compiling for
	debugging.
	* mstoop.h: Force ACCESSOR_DEBUGGING off when optimizing.

1991-01-22  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Added putenv().

1991-01-05  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Converted executePrimitiveOperation to do returns as
	soon as possible, to not use the failed variable,
	and to not do double switching on int and float
	operations.  This simple change increased performance
	from ~130K bytecodes/sec (SS1+ optim) to > 200k
	bytecodes/sec (simple code, builtins and primitives
	only, no real method invocation).
	* mstsysdep.c: Added getMilliTime().

1991-01-01  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Switched to not creating MethodContexts always...just
	use a cache of pre-made fake method contexts and only
	create real method contexts when someone will get a
	reference to one of the method contexts.

1990-11-26  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Fixed whileTrue: and whileFalse: to loop only if the
	value returned by the receiver is the expected one,
	instead of if it's the boolean not of the expected
	value.

1990-11-24  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Fixed to set quietExecution using || instead of |
	(HP doesn't like it otherwise).

1990-11-17  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Added support for UnixStream primitives.
	* mstmain.c: Added UnixStream and IOCtl to kernel files.

1990-11-10  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Added support for retaining the latest compiled method
	so the interpreter can return it from the compile:
	primitive.
	* mstcomp.h: Added latestCompiledMethod, so that some of the
	compile methods can get the method that they just
	compiled and set its category.

1990-11-06  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Added the per-user pre-image file...this may turn
	into a kind of site defaults thing, but this is what
	I've wanted for a while.

1990-10-13  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Converted to use bit masks instead of bit fields,
	hoping to improve performance somewhat.

1990-10-02  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Fixed okToLoadBinary so that it returns false if
	there is a Smalltalk file found locally, but there
	is no image file locally (the stix problem).
	* mstmain.h: findImageFile was changed to return Boolean.

1990-09-21  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Fixed so that a block that contains no statements
	properly returns nil.

1990-08-21  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added support for subtypes of CObject to provide
	direct access to C data.

1990-08-11  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Added knowledge of byteArrayOut type.

1990-08-03  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Added allocCObject.
	* mstinterp.c: Added support for primitive C object allocation
	routine.

1990-05-22  Steve Byrne  (sbb@gnu.org)

	*** Version 1.1.1 released (I think. I added this on May 10th, 1999... --- pb)
	* mstmain.c: Improved on Doug's mapping with macro to improve
	readability.
	* mstmain.c: Short name stuff added, thanks to Doug McCallum.

1990-05-20  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Improved error handling...compiler errors set a flag,
	and execution does not occur if the expression to be
	executed has compilation errors.
	* mstinterp.c: Improved error handling when error: or
	doesNotUnderstand: occurs.  Also, added ^C handling
	to abort execution.

1990-05-17  Steve Byrne  (sbb@gnu.org)

	* mstsysdep.c: Added enableInterrupts and disableInterrupts.
	System V.3 code signal support from Doug McCallum
	(thanks, Doug!).

1990-05-16  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Added usage of emacsProcess.
	* mstsym.c: Changed usages of "entry" to "ent" to prevent
	collisions with C compilers which have this identifier
	as a reserved word.
	* mstsysdep.c: Created.
	* mstsysdep.h: Created.

1990-04-24  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Improved error handling for fopen/popen primitives.
	* mstlex.c: Error checking for integers too large.

1990-04-21  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Added toByteArray.
	* mstsym.c: Addded byteArraySymbol.

1990-04-20  Steve Byrne  (sbb@gnu.org)

	* mstbyte.c: Added initByteCodes to fix a robustness issue with
	the compiler.
	* mstcomp.c: Fixed compiler to reset the byte code system before
	using it.  The problem was if an error occurred, the
	old byte code stream was still in use, and further
	compilations were losing in a big way.
	* mstinterp.c: Make fileIn not close the stream that it's reading
	from; this is taken care of by the caller, and causes
	very strange behavior if we try to close it twice!
	* mstlex.c: Added the closeIt argument to popStream so that the
	closing behavior could be separated from the popping
	behavior (in particular, for fileIn).

1990-04-17  Steve Byrne  (sbb@gnu.org)

	* mstsave.c: Fixing binary save to save only to the maximum used
	OOP slot, instead of saving the entire OOP table. This
	should improve load time and decrease disk storage
	requirements.

1990-04-08  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Changed oopFree to oopValid to fix the bug with
	someInstance losing after GC's due to objects that
	have non-free OOP table entries, but point to freed
	objects.
	* mstoop.h: Changed oopFree to oopValid to better reflect the
	semantics.

1990-04-07  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added declaration tracing primitive.
	* mstinterp.c: Fixed fileIn: to check for existence of the file
	before trying to open it.  Returns failure if the
	file cannot be accessed.
	* mstlex.c: Character lexing routines (such as nextChar) now
	return ints to get around problems on implementations
	that don't sign extend characters by default.
	* mstoop.c: Increased mem space size to 4M.  This can be decreased
	as necessary.

1990-03-25  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Changed cache hit ratio reporting to check for divide
	by zero, and to cast the byte counter to double
	(it was casting to float and relying on promotion).
	* mstinterp.c: Minor change for AtariSt: decrease size of ASYNC
	queue size.
	* mstmain.c: ProcessorScheduler is too long of a name for the
	Atari; there are uniqueness problems.  Shortened to
	ProcScheduler.  Also, fixed quietExecution; wasn't
	set when reading from the terminal; should have been
	set to false (since the loading of the quiet things
	is over).

1990-02-24  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Update to change log: there are no longer any
	explicitly allocated OOPs due to the new symbol table
	structure; the September 20th, 1989 comment below is now a noop.

1990-02-15  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added support for := as alternative assignment
	operator.

1990-02-11  Steve Byrne  (sbb@gnu.org)

	* mstsave.c: Changed the header to record the size of the oop
	table, since trying to load back into a system with
	a different sized oop table loses bigtime.

1990-01-13  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Added support for "thisContext" as a compiler built-in
	variable.
	* mstsym.c: Added thisContextSymbol.
	* mstsym.h: Added thisContextSymbol.

1990-01-07  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Added more commentary to classes, added new global
	Smalltalk variable: Bigendian, which allows code to
	be conditional based on the architecture type.

1989-12-28  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Compiled methods now record their exact number of
	byte codes.  Previously, if the byte codes didn't
	exactly fill to a word-boundary, there was no way
	to distinguish that case.  Now, with the advent of
	dumping byte codes from within Smalltalk, this has
	become a necessity.

1989-12-27  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Realloc literal vec wasn't reallocing in units of
	sizeof(OOP), so after a while, the literal vector
	wasn't big enough.  Typically most methods don't have
	a lot of literals, so this was not a problem.

1989-12-19  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Added suport for primitive filein (for use with
	autoload -- "12 gauge autoloader", A. Swartzenegger,
	The Terminator)
	* mstsym.c: Rebuilt symbol table.  Used to use the main OOP table
	as a symbol table, due to issues involving initial
	bootstrapping of the system.  Now using open hash
	table built of arrays and linked lists, so that no
	special precautions need be taken by the GC system
	or the image save/restore facility.

1989-10-15  Steve Byrne  (sbb@gnu.org)

	* mstpaths.h: Created.
	* mstmain.c: Added support for creating an "installed" version
	of Smalltalk.  There is now an include file that the
	installer can customize for his site that provides
	default locations to be checked for the kernel .st
	files and the binary image file, but these can be
	overidden in two ways: a) by a file of the same name
	in the user's current directory, or b) environment
	variables SMALLTALK_KERNEL and SMALLTALK_IMAGE.

1989-10-02  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Fixed a bug with compilation of cascaded messages. see
	HACK ALERT in the file.

1989-09-23  Steve Byrne  (sbb@gnu.org)

	* mst.h: Modifications to support operation on a DECstation 3100.

1989-09-21  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Made compilation of methods from strings record the
	source string.

1989-09-20  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Added oop table slot GC'ing.  I'm not dealing with oop
	table slots that are explictly allocated; I believe
	that most OOP slots are not explicitly chosen and so
	not running the incremental reclaimer for that case
	shouldn't hurt us.

1989-09-13  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Various changes for garbage collector.
	* mst.h: Sigh!!! modified pushOOP and setStackTop to move
	the objects that they refer to to toSpace...good
	bye performance!

1989-09-12  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: Much of the garbage collector's operation depends on
	the fact that only 1 flip will occur between any two
	operations (such as a compilation, or a byte-code).
	The code would be much more complex if this were not
	the case, and I'm not sure that things would even be
	possible if this were not the case.  Anyway, there
	is code in this routine to check for that eventuality
	and to halt the system if it occurs.

1989-09-07  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Started adding garbage collection support.

1989-09-06  Steve Byrne  (sbb@gnu.org)

	* mstoop.c: started implementing the garbage collector (YAY!!!)

1989-09-03  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: added getCurFileName
	* mstlex.h: added getCurFileName

1989-09-02  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Began adding support for the method descriptor
	instance variable.
	* mstcomp.h: Moved common compiled method structure definition
	here, so that the interpeter could share.
	* mstcomp.h: added descriptor support
	* mstinterp.c: Process primitives in and working...starting to switch
	to compiled methods with descriptor instance variable
	in addition to header.

1989-08-30  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Fixed a bug in parseIdent which was parsing foo:2 note
	no space) not as foo: and 2, but as a mixed up token.

1989-08-09  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Conversion completed.  Performance now 40k
	bytecodes/sec; was 43k bytecodes/sec.

1989-07-25  Steve Byrne  (sbb@gnu.org)

	* mstsym.c: Changed undeclareName to take a parameter that
	controls whether the frame index is decremented
	or not.  It appears that each block gets its own,
	non-shared temporaries/arguments, so that if the
	block is used in a process, other blocks won't have
	strange things happening to their arguments.

1989-07-18  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Began conversion from stack based method contexts and
	blocks to more traditional method contexts and blocks.
	This change was done 1) to make call in from C easier,
	2) to make processs possible (they could have been
	implemented using stack based contexts, but somewhat
	space-wastefully), and 3) to conform with the more
	traditional definition of method contexts and block
	contexts.

1989-07-08  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added prompt when input is a terminal.  This should
	help Emacs's shell mode determine what has been typed
	as input to the system.

1989-07-04  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Added support for user init files (in ~/.stinit),
	which are invoked on every startup.  Also, added
	support for initBlocks, which are blocks that are
	stored in the system and invoked on each startup
	(these could be used, for example, as an interim
	measure for declaring C callouts until the callout
	descriptor is converted to a Smalltalk object).

1989-06-04  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Added Smalltalk data conversion type.

1989-05-29  Steve Byrne  (sbb@gnu.org)

	* mstcint.c: Created.
	* mstcint.h: Created.
	* mstdict.c: Added the memory classes.  Added the FileStream about
	a week ago.

1989-05-26  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: added method cache!  Why didn't I spend the 1/2
	hour sooner?

1989-05-14  Steve Byrne  (sbb@gnu.org)

	* mstlex.h: Created.

1989-04-29  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Author changed from single to married.

1989-04-05  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Restructured Class and Metaclass creation.  Is now
	table driven, and metaclasses are created containing
	the proper information.
	* mstsave.c: Modified to reflect change in classes: now their name
	is a Smalltalk string; before, it was a C string that
	had to be saved specially.

1989-03-29  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Removed MethodDictionary as a separate type; it is
	an IdentityDictionary.

1989-03-11  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Smalltalk is now an instance of SystemDictionary.

1989-03-10  Steve Byrne  (sbb@gnu.org)

	* mstmain.c: Added support for automatically loading image file
	if it's newer than and of the system source files.

1989-03-04  Steve Byrne  (sbb@gnu.org)

	* mstmain.h: Created.
	* mstsave.c: Created.
	* mstsave.h: Created.

1989-01-24  Steve Byrne  (sbb@gnu.org)

	* mstlex.c: Added 2 chars of push back, because 3. needs to look
	ahead one more character to see if its 3.DIGIT or
	3. next statement.

1989-01-13  Steve Byrne  (sbb@gnu.org)

	* mstdict.c: Created.
	* mstdict.h: Created.
	* mstoop.c: Created.
	* mstoop.h: Created.

1989-01-07  Steve Byrne  (sbb@gnu.org)

	* mstinterp.c: Created.
	* mstinterp.h: Created.

1989-01-05  Steve Byrne  (sbb@gnu.org)

	* mstsym.c: Created.

1989-01-02  Steve Byrne  (sbb@gnu.org)

	* mstbyte.h: Created.

1989-01-01  Steve Byrne  (sbb@gnu.org)

	* mstcomp.c: Created.
	* mstcomp.h: Created.
	* mstsym.h: Created.

1988-12-30  Steve Byrne  (sbb@gnu.org)

	* msttree.c: Created.
	* msttree.h: Created.

1988-12-29  Steve Byrne  (sbb@gnu.org)

	* mst.h: Created.

1988-12-27  Steve Byrne  (sbb@gnu.org)

	* mstbyte.c: created.
	* mstid.c: Created.
	* mstid.h: created.
	* mstlex.c: Created.
	* mstmain.c: Created.
	* mststr.c: created.
	* mststr.h: created.


